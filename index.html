<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/31/rust-0407-closures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/31/rust-0407-closures/" itemprop="url">Rust lesson 4.7 - Closures</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-31T21:31:37+08:00">
                2024-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h1><p>Closures are anonymous functions in rust, and they:</p>
<ul>
<li>can be saved in a variable</li>
<li>can be used as arguments in other functions</li>
<li>can capture values from the environment</li>
<li>type annotations are not required, compiler can infer the types from the context most times.</li>
</ul>
<h2 id="1-Capturing-the-Environment-with-Closures"><a href="#1-Capturing-the-Environment-with-Closures" class="headerlink" title="1. Capturing the Environment with Closures"></a>1. Capturing the Environment with Closures</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span>= |n| n==x; <span class="comment">// the closure awares the &#x27;x&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>=<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Closure-Type-Inference-and-Annotation"><a href="#2-Closure-Type-Inference-and-Annotation" class="headerlink" title="2. Closure Type Inference and Annotation"></a>2. Closure Type Inference and Annotation</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span>  <span class="title function_">add_one_v1</span>   (x: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123; x + <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v2</span> = |x: <span class="type">u32</span>| <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123; x + <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v3</span> = |x|             &#123; x + <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v4</span> = |x|               x + <span class="number">1</span>  ;</span><br></pre></td></tr></table></figure>

<p>Compiler can infer the types of parameters and return types most cases, however, compiler will infer one concrete type for each.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">example_closure</span> = |x| x;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">example_closure</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>)); <span class="comment">//the type of the closure is String from now on.</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">n</span> = <span class="title function_ invoke__">example_closure</span>(<span class="number">5</span>); <span class="comment">//won&#x27;t work.</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Capturing-References-or-Moving-Ownership"><a href="#3-Capturing-References-or-Moving-Ownership" class="headerlink" title="3. Capturing References or Moving Ownership"></a>3. Capturing References or Moving Ownership</h2><p>Closures can capture values form their in three ways:</p>
<ul>
<li>borrowing immutably</li>
<li>borrowing mutably</li>
<li>taking ownership</li>
</ul>
<p>And the closure <strong>itself</strong> will decide which to use.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Before defining closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line">    <span class="comment">//the parameter need to declared first!</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">only_borrows</span> = || <span class="built_in">println!</span>(<span class="string">&quot;From closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Before calling closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">only_borrows</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;After calling closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">list</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Before defining closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">borrows_mutably</span> = || list.<span class="title function_ invoke__">push</span>(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">borrows_mutably</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;After calling closure: &#123;list:?&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Taking-the-ownership"><a href="#Taking-the-ownership" class="headerlink" title="Taking the ownership"></a>Taking the ownership</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x = &#123;:?&#125;&quot;</span>, x);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">equal_to_x</span> = <span class="keyword">move</span> |n| n == x; <span class="comment">// x is moved to the clousre</span></span><br><span class="line"><span class="comment">//println!(&quot;x = &#123;:?&#125;&quot;, x); this is invalid</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br></pre></td></tr></table></figure>

<h2 id="4-Moving-Captured-Values-Out-of-Closures-and-the-Fn-Traits"><a href="#4-Moving-Captured-Values-Out-of-Closures-and-the-Fn-Traits" class="headerlink" title="4. Moving Captured Values Out of Closures and the Fn Traits"></a>4. Moving Captured Values Out of Closures and the Fn Traits</h2><p>How the closure’s body handles the values determines the way it capture the values. Specificly, which traits the closure implements.</p>
<ol>
<li><code>FnOnce</code>: move values out of its body, once only.</li>
<li><code>FnMut</code>: mutate the captured values, more that once.</li>
<li><code>Fn</code>: immutate the captured values, or capture nothing; multiple times concurrently</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/30/rust-0405-traits_2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/30/rust-0405-traits_2/" itemprop="url">Rust lesson 4.5 - Advanced Traits</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-30T20:04:13+08:00">
                2024-10-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Advanced-Traits"><a href="#Advanced-Traits" class="headerlink" title="Advanced Traits"></a>Advanced Traits</h1><p>We have discussed trait in <a target="_blank" rel="noopener" href="https://caodanbobo.github.io/2024/10/08/rust-0303-functions/">function</a>, let us check out the advanced features of Traits.</p>
<h2 id="1-Associated-Types"><a href="#1-Associated-Types" class="headerlink" title="1. Associated Types"></a>1. Associated Types</h2><p>Associated types connect a t<strong>ype placeholder</strong> with a trait such that the trait method definitions can use these placeholder types in their signatures.</p>
<p>In this example, the associate type <code>item</code> is used as the placeholder for return type.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator</span> <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = <span class="type">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This can be done by generics as well:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There difference between these two is:</p>
<ul>
<li>Traits with generics can be implemented multiple times for each concrete types.</li>
<li>With associated types, we can only implement a trait once on a type.</li>
</ul>
<h2 id="2-Default-Generic-Type-Parameters-and-Operator-Overloading"><a href="#2-Default-Generic-Type-Parameters-and-Operator-Overloading" class="headerlink" title="2. Default Generic Type Parameters and Operator Overloading"></a>2. Default Generic Type Parameters and Operator Overloading</h2><p>When declaring the trait, we can specift a default concrete type as default as Parameters type with <code>&lt;PlaceholderType=ConcreteType&gt;</code> syntax.</p>
<p>Following codes is Trait <code>std::ops::Add</code>, it also an example showing us how to overloading operator defined in <code>std::ops</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Add</span>&lt;Rhs = <span class="keyword">Self</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Required method</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, rhs: Rhs) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::Output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>whem implemt it on <code>Point</code>, the second parameter of ‘add’ is also <code>Point</code> itself:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Copy, Clone, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//impl Add&lt;Point&gt; for Poing</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Add</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = Point;</span><br><span class="line">    <span class="comment">// Point as Self</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, other: Point) <span class="punctuation">-&gt;</span> Point &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x + other.x,</span><br><span class="line">            y: <span class="keyword">self</span>.y + other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And the default type can be replaced as well:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Millimeters</span>(<span class="type">u32</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Meters</span>(<span class="type">u32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Add</span>&lt;Meters&gt; <span class="keyword">for</span> <span class="title class_">Millimeters</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = Millimeters;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, other: Meters) <span class="punctuation">-&gt;</span> Millimeters &#123;</span><br><span class="line">        <span class="title function_ invoke__">Millimeters</span>(<span class="keyword">self</span>.<span class="number">0</span> + (other.<span class="number">0</span> * <span class="number">1000</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>Rhs</code> type is customized to <code>Meters</code>.</p>
<h2 id="3-Fully-Qualified-Syntax"><a href="#3-Fully-Qualified-Syntax" class="headerlink" title="3. Fully Qualified Syntax"></a>3. Fully Qualified Syntax</h2><p>Sometimes, There are methods or functions from different traits sharing same name. How do we distinguish them from each other?</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Pilot</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Wizard</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Human</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Pilot</span> <span class="keyword">for</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;This is your captain speaking.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Wizard</span> <span class="keyword">for</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Up!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*waving arms furiously*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, There are 3 <code>fly</code> methods in <code>Human</code>, and we can use the trait name to clarify the one we want to call:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">person</span> = Human;</span><br><span class="line">    Pilot::<span class="title function_ invoke__">fly</span>(&amp;person); <span class="comment">//This is your captain speaking.</span></span><br><span class="line">    Wizard::<span class="title function_ invoke__">fly</span>(&amp;person);<span class="comment">//Up!</span></span><br><span class="line">    person.<span class="title function_ invoke__">fly</span>(); <span class="comment">//waving arms furiously</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, the associate functions wound not work like this with trait name, fully qualified syntax is required:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spot&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;puppy&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a &#123;&#125;&quot;</span>, Dog::<span class="title function_ invoke__">baby_name</span>()); <span class="comment">//Spot</span></span><br><span class="line">    <span class="comment">//this next line will not work</span></span><br><span class="line">    <span class="comment">//println!(&quot;A baby dog is called a &#123;&#125;&quot;, Animal::baby_name());</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a &#123;&#125;&quot;</span>, &lt;Dog <span class="keyword">as</span> Animal&gt;::<span class="title function_ invoke__">baby_name</span>()); <span class="comment">//puppy</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Supertraits"><a href="#4-Supertraits" class="headerlink" title="4. Supertraits"></a>4. Supertraits</h2><p>if we want to add extra functionalities on another trait, the trait is relied on is call <em>supertrait</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">OutlinePrint</span>: fmt::Display &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">outline_print</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">output</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">len</span> = output.<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;*&quot;</span>.<span class="title function_ invoke__">repeat</span>(len + <span class="number">4</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*&#123;&#125;*&quot;</span>, <span class="string">&quot; &quot;</span>.<span class="title function_ invoke__">repeat</span>(len + <span class="number">2</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;* &#123;output&#125; *&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*&#123;&#125;*&quot;</span>, <span class="string">&quot; &quot;</span>.<span class="title function_ invoke__">repeat</span>(len + <span class="number">2</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;*&quot;</span>.<span class="title function_ invoke__">repeat</span>(len + <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>we create a trait <code>OutlinePrint</code> relying on <code>fmt::Display</code> which provides <code>to_string</code> method.</p>
<p>To implement this <code>OutlinePrint</code>, the type must implement the <code>fmt::Display</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;(&#123;&#125;, &#123;&#125;)&quot;</span>, <span class="keyword">self</span>.x, <span class="keyword">self</span>.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">OutlinePrint</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/26/rust-0406-Macros/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/26/rust-0406-Macros/" itemprop="url">Rust lesson 4.6 - Macros</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-26T20:37:50+08:00">
                2024-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Macros"><a href="#Macros" class="headerlink" title="Macros"></a>Macros</h1><ul>
<li><em>declarative</em><ul>
<li><code>macro_rules!</code></li>
</ul>
</li>
<li><em>procedural</em><ul>
<li>Custom <code>#[derive]</code> macros</li>
<li>Attribute-like macros</li>
<li>Function-like macros</li>
</ul>
</li>
</ul>
<h2 id="1-What-are-macros"><a href="#1-What-are-macros" class="headerlink" title="1. What are macros"></a>1. What are macros</h2><p>A way of writing code that writes other code, aka. <em>metaprogramming</em>. For example:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">u32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//vec![1, 2, 3] would be replaced by following block</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">temp_vec</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    temp_vec.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">    temp_vec.<span class="title function_ invoke__">push</span>(<span class="number">2</span>);</span><br><span class="line">    temp_vec.<span class="title function_ invoke__">push</span>(<span class="number">3</span>);</span><br><span class="line">    temp_vec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In addition, camparing to functions, macros:</p>
<ul>
<li>Operate at compile time, they can produce code that implements traits for type</li>
<li>can take a variable number of parameters</li>
<li>must be defined or brought into scope before you call them in a file</li>
</ul>
<h2 id="2-Declarative-Macros"><a href="#2-Declarative-Macros" class="headerlink" title="2. Declarative Macros"></a>2. Declarative Macros</h2><p>Let us check out <code>vec!</code> under the hood.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> vec &#123;</span><br><span class="line">    ( $( $x:expr ),* ) =&gt; &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">temp_vec</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">            $(</span><br><span class="line">                temp_vec.<span class="title function_ invoke__">push</span>($x);</span><br><span class="line">            )*</span><br><span class="line">            temp_vec</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>#[macro_export]</code> indicates that this macros will be available for code brought the crate.</li>
<li><code>macro_rules! vec&#123;&#125;</code> defines the macro.</li>
<li><code>()=&gt;&#123;&#125;</code> is smililar to the pattern in <code>match</code> flow, but it matchs against the syntax.</li>
<li><code>&amp;</code> is for variable that the code matching the pattern</li>
<li><code>$x:expr</code> indicates this is a pattern for expression, and naming it <code>$x</code>.</li>
<li><code>$( $x:expr ),*</code> is the pattern that matches code with multiple expression separated by ‘,’.</li>
<li><code>$()*</code> inside the arm is generated for each part matches <code>$()</code>.</li>
</ul>
<h2 id="3-Procedural-Macros"><a href="#3-Procedural-Macros" class="headerlink" title="3. Procedural Macros"></a>3. Procedural Macros</h2><p>Procedural macros accept some code as an input, operate on that code, and produce some code as an output.</p>
<h3 id="3-1-Custom-derive-Macro"><a href="#3-1-Custom-derive-Macro" class="headerlink" title="3.1 Custom derive Macro"></a>3.1 Custom derive Macro</h3><p>Used to implement traits for structs or enums automatically by adding <code>#[derive(TraitName)]</code>. These macros are marked with <code>#[proc_macro_derive]</code> and are often used for common traits like Debug or Clone, but custom derive macros can be created to automate repetitive implementations.</p>
<h3 id="3-2-Attribute-like-Macro"><a href="#3-2-Attribute-like-Macro" class="headerlink" title="3.2 Attribute-like Macro"></a>3.2 Attribute-like Macro</h3><p>These are applied to items like functions or modules with <code>#[proc_macro_attribute]</code>. They allow you to add custom attributes that modify the behavior of the decorated item.</p>
<h3 id="3-1-Function-like-Macro"><a href="#3-1-Function-like-Macro" class="headerlink" title="3.1 Function-like Macro"></a>3.1 Function-like Macro</h3><p>These resemble functions and can be used anywhere you’d use a regular function call. They are defined with <code>#[proc_macro]</code> and are commonly used for code generation based on input.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/22/rust-0404-rc&refcell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/22/rust-0404-rc&refcell/" itemprop="url">Rust lesson 4.4 - Smart Pointer II</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-22T21:52:05+08:00">
                2024-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Smart-Pointer-Part-II"><a href="#Smart-Pointer-Part-II" class="headerlink" title="Smart Pointer Part II"></a>Smart Pointer Part II</h1><h2 id="1-Rc"><a href="#1-Rc" class="headerlink" title="1. Rc&lt;T&gt;"></a>1. <code>Rc&lt;T&gt;</code></h2><p><code>Rc&lt;T&gt;</code> is design to handle multiple ownerships cases, e.g., graphs, tree.</p>
<p>Imgine there is linked list:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b -&gt; 3 -&gt;</span><br><span class="line">     a -&gt; 5 -&gt; 10</span><br><span class="line">c -&gt;4 -&gt;</span><br></pre></td></tr></table></figure>

<p><strong>How are gonna represent it in rust?</strong></p>
<h3 id="1-Using-Box"><a href="#1-Using-Box" class="headerlink" title="1. Using Box"></a>1. Using Box<T></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//code with errors</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Nil))));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(a)); <span class="comment">// use of moved value &#x27;a&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Box&lt;T&gt;</code> is for single ownership, it does not fit here.</p>
<h3 id="2-Using-references"><a href="#2-Using-references" class="headerlink" title="2. Using references"></a>2. Using references</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, &amp;<span class="symbol">&#x27;a</span> List&lt;<span class="symbol">&#x27;a</span>&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, &amp;<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, &amp;Nil));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, &amp;a);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, &amp;a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This would work with carefully handled lifetimes, not for every scenario.</p>
<h3 id="3-Rc"><a href="#3-Rc" class="headerlink" title="3. Rc&lt;T&gt;"></a>3. <code>Rc&lt;T&gt;</code></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Rc::<span class="title function_ invoke__">new</span>(Nil)))));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after creating a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a)); <span class="comment">//1</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after creating b = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a)); <span class="comment">//2</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count after creating c = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));<span class="comment">//3</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after c goes out of scope = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));<span class="comment">//2, compiler drop c</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Via <strong>immutable</strong> references, Rc<T> allows you to share data between multiple parts of your program for <strong>reading only</strong>.</p>
<h3 id="How-Rc-works"><a href="#How-Rc-works" class="headerlink" title="How Rc&lt;T&gt; works"></a>How <code>Rc&lt;T&gt; </code>works</h3><p>Rc is abbreviation of Reference Counting,</p>
<ul>
<li>it type keeps track of the number of references to a value:<ul>
<li><code>Rc::new</code> or <code>Rc::clone</code> would increase the counter by 1.</li>
<li><code>drop</code> would decrease the counter by 1.</li>
</ul>
</li>
<li>if the number of reference goes to 0, the Rc<T> will be clean up completely.</li>
</ul>
<h2 id="2-RefCell"><a href="#2-RefCell" class="headerlink" title="2. RefCell&lt;T&gt;"></a>2. <code>RefCell&lt;T&gt;</code></h2><p>Rc<T> is immutable reference for read-only, what if we’d like to modify the list in former example?</p>
<p><strong>Interior mutability</strong> is a design pattern in Rust that allows you to mutate data even when there are immutable references to that data:<br><em><strong>it bypasses the compiler borrow checker using <code>unsafe</code>.</strong></em></p>
<p>we are going to look at the RefCell<T>, let us compare it with Rc<T> and Box<T> first.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>Rc&lt;T&gt;</code></th>
<th><code>Box&lt;T&gt;</code></th>
<th><code>RefCell&lt;T&gt;</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Immutable Borrowing</strong></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td><strong>Mutate Borrowing</strong></td>
<td>no</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td><strong>Multiple Owners</strong></td>
<td>no</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td><strong>Borrow Check</strong></td>
<td>compile time</td>
<td>compile time</td>
<td>runtime</td>
</tr>
</tbody></table>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">rc_1</span> = RefCell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ref_01</span> = rc_1.<span class="title function_ invoke__">borrow</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ref_02</span> = rc_1.<span class="title function_ invoke__">borrow</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;ref_01= &#123;ref_01:?&#125;&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;ref_02= &#123;ref_02:?&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">m_ref_01</span> = rc_1.<span class="title function_ invoke__">borrow_mut</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;m_ref_01= &#123;m_ref_01:?&#125;&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="How-RefCell-works"><a href="#How-RefCell-works" class="headerlink" title="How RefCell&lt;T&gt; works"></a>How <code>RefCell&lt;T&gt; </code>works</h3><ul>
<li><code>RefCell&lt;T&gt;</code> keeps track of the number of active smart pointer<ul>
<li><code>Ref&lt;T&gt;</code> is created and returned from <code>borrow</code>, each of them is a immutable reference.</li>
<li><code>RefMut&lt;T&gt;</code> is created and returned from <code>borrow_mut</code>, it is the mutable reference.</li>
</ul>
</li>
<li><code>RefCell&lt;T&gt;</code> follows reference borrow rules. However the borrow check is performed at runtime, panic if violations occur.</li>
</ul>
<h3 id="Having-Multiple-Owners-of-Mutable-Data-by-Combining-Rc-and-RefCell"><a href="#Having-Multiple-Owners-of-Mutable-Data-by-Combining-Rc-and-RefCell" class="headerlink" title="Having Multiple Owners of Mutable Data by Combining Rc&lt;T&gt; and RefCell&lt;T&gt;"></a>Having Multiple Owners of Mutable Data by Combining <code>Rc&lt;T&gt; </code>and <code>RefCell&lt;T&gt;</code></h3><p>A common way to use <code>RefCell&lt;T&gt; </code>is in combination with <code>Rc&lt;T&gt;</code>. Recall that <code>Rc&lt;T&gt;</code> lets you have multiple owners of some data, but it only gives immutable access to that data. If you have an <code>Rc&lt;T&gt; </code>that holds a <code>RefCell&lt;T&gt;,</code> you can get a value that can have multiple owners and that you can mutate!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(Rc&lt;RefCell&lt;<span class="type">i32</span>&gt;&gt;, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">value</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;value), Rc::<span class="title function_ invoke__">new</span>(Nil)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">3</span>)), Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">4</span>)), Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    *value.<span class="title function_ invoke__">borrow_mut</span>() += <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a after = &#123;a:?&#125;&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b after = &#123;b:?&#125;&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;c after = &#123;c:?&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//a after = Cons(RefCell &#123; value: 15 &#125;, Nil)</span></span><br><span class="line"><span class="comment">//b after = Cons(RefCell &#123; value: 3 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span></span><br><span class="line"><span class="comment">//c after = Cons(RefCell &#123; value: 4 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span></span><br></pre></td></tr></table></figure>

<h2 id="How-to-prevent-memory-leak"><a href="#How-to-prevent-memory-leak" class="headerlink" title="How to prevent memory leak?"></a>How to prevent memory leak?</h2><h3 id="Reference-Cycle"><a href="#Reference-Cycle" class="headerlink" title="Reference Cycle"></a>Reference Cycle</h3><p>Since <code>RefCell&lt;T&gt;</code> allows mutable borrow, <code>and Rc&lt;T&gt;</code> allows multiple ownership, we can use them to create reference cycle leading to memory leak.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, RefCell&lt;Rc&lt;List&gt;&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">tail</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;RefCell&lt;Rc&lt;List&gt;&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Cons</span>(_, item) =&gt; <span class="title function_ invoke__">Some</span>(item),</span><br><span class="line">            Nil =&gt; <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>In this code example, <code>Cons</code> is a tuple variant, and the second element is a mutable multiple-ownerable <code>List</code>.To create a reference cycle, we can create two <code>List</code> and let them own each other.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, RefCell::<span class="title function_ invoke__">new</span>(Rc::<span class="title function_ invoke__">new</span>(Nil)))); <span class="comment">// a -&gt; Nil</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a initial rc count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a next item = &#123;:?&#125;&quot;</span>, a.<span class="title function_ invoke__">tail</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, RefCell::<span class="title function_ invoke__">new</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;a)))); <span class="comment">//b -&gt; a -&gt; Nil</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a rc count after b creation = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b initial rc count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;b));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b next item = &#123;:?&#125;&quot;</span>, b.<span class="title function_ invoke__">tail</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(link) = a.<span class="title function_ invoke__">tail</span>() &#123;</span><br><span class="line">        *link.<span class="title function_ invoke__">borrow_mut</span>() = Rc::<span class="title function_ invoke__">clone</span>(&amp;b); <span class="comment">// a &lt;-&gt; b</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b rc count after changing a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;b)); <span class="comment">//2</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a rc count after changing a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a)); <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Uncomment the next line to see that we have a cycle;</span></span><br><span class="line">    <span class="comment">// it will overflow the stack</span></span><br><span class="line">    <span class="comment">// println!(&quot;a next item = &#123;:?&#125;&quot;, a.tail());</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At the end of <code>main</code>, rust would <em>drop</em> both <code>a</code> and <code>b</code>. However, the the strong_count of Rc<List> will never reach 0, the memory allocated will remain uncollected forever.</p>
<h3 id="Weak"><a href="#Weak" class="headerlink" title="Weak&lt;T&gt;"></a><code>Weak&lt;T&gt;</code></h3><p>There is <code>weak_count</code> similar to <code>strong_count</code> we learnt previously, They both are counter of the reference of <code>Rc&lt;T&gt;</code>. The main difference between them is that the value of weak_count won’t affect the memory cleanup.</p>
<ul>
<li><code>Rc::downgrade()</code> return a <code>Weak&lt;T&gt;</code> of the <code>Rc&lt;T&gt;</code> instance.</li>
<li><code>Rc::upgrade()</code> return a <code>Option&lt;Rc&lt;T&gt;&gt;</code> of the <code>Weak&lt;T&gt;</code> instance. This is because the value that Weak<T> references might dropped already.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/22/rust-0403-lifetime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/22/rust-0403-lifetime/" itemprop="url">Rust lesson 4.3 - lifetime</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-22T20:00:46+08:00">
                2024-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Undstanding-Lifetime"><a href="#Undstanding-Lifetime" class="headerlink" title="Undstanding Lifetime"></a>Undstanding Lifetime</h1><p>Lifetimes are Rust’s way of ensuring that references are always valid. The compiler checks that the lifetime of a reference is never longer than the lifetime of the data it points to, preventing dangling references.</p>
<h2 id="The-Borrow-checker"><a href="#The-Borrow-checker" class="headerlink" title="The Borrow checker"></a>The Borrow checker</h2><p>The <strong>borrow checker</strong> compares scopes to determine whether all borrows are valid.<br>In following example, variable <code>r</code> is a reference to <code>x</code>, but the lifetime of <code>r</code> is <code>&#39;a</code>, which is longer than <code>x</code>‘s, and <strong>this is Invalid</strong>: <code>r</code> will be a dangling reference after the compiler <em>drop</em> <code>x</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//code with errors</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span>;                <span class="comment">// ---------+-- &#x27;a</span></span><br><span class="line">                          <span class="comment">//          |</span></span><br><span class="line">    &#123;                     <span class="comment">//          |</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;        <span class="comment">// -+-- &#x27;b  |</span></span><br><span class="line">        r = &amp;x;           <span class="comment">//  |       |</span></span><br><span class="line">    &#125;                     <span class="comment">// -+       |</span></span><br><span class="line">                          <span class="comment">//          |</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;r: &#123;r&#125;&quot;</span>);   <span class="comment">//          |</span></span><br><span class="line">&#125;                         <span class="comment">// ---------+</span></span><br></pre></td></tr></table></figure>

<h2 id="Lifetime-Annotation"><a href="#Lifetime-Annotation" class="headerlink" title="Lifetime Annotation"></a>Lifetime Annotation</h2><p>Sometimes, the compiler has no a idea what lifetime time of borrows would be. In following example, the lifetime of what <code>longest</code> returns varies.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//code with errors</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>(x: &amp;<span class="type">str</span>, y: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So <strong>life annotation</strong> is intruduced to describe the lifetime of references expilicitly.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;i32        // a reference</span><br><span class="line">&amp;&#x27;a i32     // a reference with an explicit lifetime</span><br><span class="line">&amp;&#x27;a mut i32 // a mutable reference with an explicit lifetime</span><br></pre></td></tr></table></figure>

<h3 id="How-borrow-checkers-checks-the-lifetimes"><a href="#How-borrow-checkers-checks-the-lifetimes" class="headerlink" title="How borrow checkers checks the lifetimes"></a>How borrow checkers checks the lifetimes</h3><p>Here are some examples for us to observe how compile comparing the scopes of borrows:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;longer one&quot;</span>);</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;shorter&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result_1</span> = <span class="title function_ invoke__">longest</span>(&amp;x, &amp;y);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;longest is &#123;&#125;&quot;</span>, result_1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result_2</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;shorter&quot;</span>);</span><br><span class="line">        result_2 = <span class="title function_ invoke__">longest</span>(&amp;x, &amp;y);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;longest is &#123;&#125;&quot;</span>, result_2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result_3</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;shorter&quot;</span>);</span><br><span class="line">        result_3 = <span class="title function_ invoke__">longest</span>(&amp;x, &amp;y); <span class="comment">//`y` does not live long enough</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;longest is &#123;&#125;&quot;</span>, result_3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result_4</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;shorter&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">z</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;local longer&quot;</span>);</span><br><span class="line">        result_4 = <span class="title function_ invoke__">longest</span>(&amp;z, &amp;y); <span class="comment">//both z, y do not live long enough</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;longest is &#123;&#125;&quot;</span>, result_4);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can tell that the lifetime of what <code>longest</code> return should be the shortest.</p>
<h3 id="Lifetime-Elision"><a href="#Lifetime-Elision" class="headerlink" title="Lifetime Elision"></a>Lifetime Elision</h3><p>You may have noticed that in our pervious learning, the lifetime annotation is not always required. if the codes fits the <em>lifetime elision</em> rules, you don’t need to write the lifetimes explicitly.</p>
<ol>
<li>The compiler assigns a lifetime parameter to each parameter that’s a reference.</li>
<li>If there is exactly one <strong>input</strong> lifetime parameter, that lifetime is assigned to all <strong>output</strong> lifetime parameters.</li>
<li>if there are multiple <strong>input</strong> lifetime parameters, but one of them is <strong>&amp;self</strong> or <strong>&amp;mut self</strong> because this is a method, the lifetime of self is assigned to <strong>all output</strong> lifetime parameters.</li>
</ol>
<h3 id="In-Structs"><a href="#In-Structs" class="headerlink" title="In Structs"></a>In Structs</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ImportantExcerpt</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    part: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The lifetime of instances of <code>ImportantExcerpt</code> can not out live the fields’ lifetimes:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ImportantExcerpt</span>&lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt; &#123;</span><br><span class="line">    part_a: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    part_b: &amp;<span class="symbol">&#x27;b</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;longer one&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">j</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;shorter&quot;</span>);</span><br><span class="line">        j = ImportantExcerpt &#123;</span><br><span class="line">            part_a: &amp;x,</span><br><span class="line">            part_b: &amp;y, <span class="comment">//invalid here, `y` does not live long enough</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="In-Methods"><a href="#In-Methods" class="headerlink" title="In Methods"></a>In Methods</h3><ul>
<li>Annotation after <code>impl</code></li>
<li>Annotation after struct name</li>
<li>since they are methods, they fit elision rule#3</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>&gt; ImportantExcerpt&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">level</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="The-Static-Lifetime"><a href="#The-Static-Lifetime" class="headerlink" title="The Static Lifetime"></a>The Static Lifetime</h2><p>One special lifetime we need to discuss is <code>&#39;static</code>, which denotes that the affected reference can live for the entire duration of the program. All <strong>string literals</strong> have the <code>&#39;static</code> lifetime, which we can annotate as follows:<br><code>let s: &amp;&#39;static str = &quot;I have a static lifetime.&quot;;</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/20/rust-0402-Generic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/20/rust-0402-Generic/" itemprop="url">Rust lesson 4.2 - Generic</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-20T19:14:11+08:00">
                2024-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introducing-Generic"><a href="#Introducing-Generic" class="headerlink" title="Introducing Generic"></a>Introducing Generic</h1><p>Generics in Rust allow you to write flexible and reusable code by parameterizing types.</p>
<h2 id="1-Generic-Functions"><a href="#1-Generic-Functions" class="headerlink" title="1. Generic Functions"></a>1. Generic Functions</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T: std:::cmp::<span class="built_in">PartialOrd</span>&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = &amp;list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-Generic-Structs"><a href="#2-Generic-Structs" class="headerlink" title="2. Generic Structs"></a>2. Generic Structs</h2><h3 id="Single-type"><a href="#Single-type" class="headerlink" title="Single type"></a>Single type</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">integer</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">float</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">    <span class="comment">//let mixed = Point &#123; x: 1.0, y: 5 &#125;;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Multiple-types"><a href="#Multiple-types" class="headerlink" title="Multiple types"></a>Multiple types</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T, U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">both_integer</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">both_float</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">integer_and_float</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Generic-Methods"><a href="#3-Generic-Methods" class="headerlink" title="3. Generic Methods"></a>3. Generic Methods</h2><p><strong>Two rulses:</strong></p>
<ul>
<li>For the generic parameters after <code>impl</code>: Same as the struct definition.</li>
<li>For methods: need to cover the non-struct ones. for ‘mixup’ in the example, X1,X2 are declared in the <code>impl</code>, so the method has to declare the other 2.</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;X1, Y1&gt; &#123;</span><br><span class="line">    x: X1,</span><br><span class="line">    y: Y1,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mixup</span>&lt;X2, Y2&gt;(<span class="keyword">self</span>, other: Point&lt;X2, Y2&gt;) <span class="punctuation">-&gt;</span> Point&lt;X1, Y2&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10.4</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Point &#123; x: <span class="string">&quot;Hello&quot;</span>, y: <span class="string">&#x27;c&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p3</span> = p1.<span class="title function_ invoke__">mixup</span>(p2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p3.x = &#123;&#125;, p3.y = &#123;&#125;&quot;</span>, p3.x, p3.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Generic-with-const"><a href="#4-Generic-with-const" class="headerlink" title="4.Generic with const"></a>4.Generic with const</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//for array with length fixed to 3.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array</span>(arr: [<span class="number">132</span>;<span class="number">3</span>])&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//for slices</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array</span>&lt;T: std::fmt::<span class="built_in">Debug</span>&gt;(arr: &amp;[T])&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//for array with any length</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array</span>&lt;T: std::fmt::<span class="built_in">Debug</span>, <span class="keyword">const</span> N:<span class="type">usize</span>&gt;(arr: [T;N])&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Performance"><a href="#5-Performance" class="headerlink" title="5. Performance"></a>5. Performance</h2><ul>
<li><strong>Performance in compilation</strong>: Costly. Monomorphization is the process of turning generic code into specific code by filling in the concrete types that are used when compiled. Which means rust would generate code for the concrete types the generic code is called with.</li>
<li><strong>Performance in runtime</strong>: No extra cost, since code for the concrete types is already generated.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/20/rust-0401-Box/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/20/rust-0401-Box/" itemprop="url">Rust lesson 4.1 - Smart Pointer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-20T15:31:53+08:00">
                2024-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introducing-smart-pointer-Box"><a href="#Introducing-smart-pointer-Box" class="headerlink" title="Introducing smart pointer Box&lt;T&gt;"></a>Introducing smart pointer <code>Box&lt;T&gt;</code></h1><h2 id="1-what-is-Box"><a href="#1-what-is-Box" class="headerlink" title="1. what is Box&lt;T&gt;"></a>1. what is <code>Box&lt;T&gt;</code></h2><p><code>Pointer</code>: A variable that contains a address of another variable, e.g., &amp;i32, &amp;[T], etc.</p>
<p><code>Box&lt;T&gt;</code> is no different, it allows us to store data on the heap, and it store a address of the heap.</p>
<h2 id="What-is-it-for"><a href="#What-is-it-for" class="headerlink" title="What is it for"></a>What is it for</h2><h3 id="1-Storing-data-on-the-heap"><a href="#1-Storing-data-on-the-heap" class="headerlink" title="1. Storing data on the heap"></a>1. Storing data on the heap</h3><p>In the following example, we store 5 on the heap instead of stack.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b = &#123;b&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Enabling-Recursive-types"><a href="#2-Enabling-Recursive-types" class="headerlink" title="2. Enabling Recursive types"></a>2. Enabling Recursive types</h3><p>The following enum is not valid in rust. Previously, we have discussed the memory layout of enum, we learnt that the size of the enum depends on the largest variant b. The <code>List</code> here is a recursize type, there is no way to know the size of it, the Rust would assume the size of it is infinite.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32, List), //wrong</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, the size of <code>Box&lt;T&gt;</code> is fixed, it enables us to use recursive types like</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Featurs-of-a-smart-pointer"><a href="#Featurs-of-a-smart-pointer" class="headerlink" title="Featurs of a smart pointer"></a>Featurs of a smart pointer</h2><h3 id="Dereference-using-Deref-Trait"><a href="#Dereference-using-Deref-Trait" class="headerlink" title="Dereference using Deref Trait"></a>Dereference using <code>Deref</code> Trait</h3><p><code>Box&lt;T&gt;</code> implements <code>Deref</code> trait which provides a function <code>deref</code> that would return the &amp;T:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Deref;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Deref <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">Self</span>::Target &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.<span class="number">0</span> <span class="comment">//MyBox is a tuple struct</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>*y</code> would be subsitutes the ‘_‘ with a call to <code>deref</code> by rust:</p>
<p><code>*y</code> &#x3D;&gt; <code>*(y.deref())</code> &#x3D;&gt; <code>*(&amp;x)</code>&#x3D;&gt;<code>x</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mutable-reference-with-DerefMut"><a href="#Mutable-reference-with-DerefMut" class="headerlink" title="Mutable reference with DerefMut"></a>Mutable reference with <code>DerefMut</code></h3><p>Similar to <code>Deref</code>, <code>DerefMut</code> provides a <code>deref_mut</code> function return a mutable reference of T:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::DerefMut;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; DerefMut <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref_mut</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span>::Target &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.<span class="number">0</span> <span class="comment">//MyBox is a tuple struct</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Cleanup-automatically"><a href="#Cleanup-automatically" class="headerlink" title="Cleanup automatically"></a>Cleanup automatically</h3><p><code>Box&lt;T&gt;</code> also implements <code>Drop</code> trait, witch provides a <code>drop</code> allowing customizeable actions when a value is about to out of scope.</p>
<p>In terms of <code>Box&lt;T&gt;</code>, the <code>drop</code> is set to deallocate the space on the heap that the box points to.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/16/rust-0308-collections/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/16/rust-0308-collections/" itemprop="url">Rust lesson 3.8 - Collections</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-16T20:55:47+08:00">
                2024-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introducing-commonly-used-collections"><a href="#Introducing-commonly-used-collections" class="headerlink" title="Introducing commonly used collections"></a>Introducing commonly used collections</h1><h2 id="1-String"><a href="#1-String" class="headerlink" title="1. String"></a>1. String</h2><h3 id="Creating-a-string"><a href="#Creating-a-string" class="headerlink" title="Creating a string"></a>Creating a string</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a emtpy string</span></span><br><span class="line"><span class="type">String</span> a_string = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">//create a string with string literals</span></span><br><span class="line"><span class="type">String</span> b_string= <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;b string&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="String-manipulation"><a href="#String-manipulation" class="headerlink" title="String manipulation"></a>String manipulation</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//append</span></span><br><span class="line">a_string.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">//a</span></span><br><span class="line">a_string.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;string&quot;</span>); <span class="comment">// astring</span></span><br><span class="line"><span class="comment">//insert</span></span><br><span class="line">a_string.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>,<span class="string">&#x27; &#x27;</span>); <span class="comment">// a string</span></span><br><span class="line">a_string.<span class="title function_ invoke__">insert_str</span>(<span class="number">2</span>,<span class="string">&quot;longer &quot;</span>); <span class="comment">// a longer string</span></span><br><span class="line"><span class="comment">//replace</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">shorter</span>=a_string.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;longer&quot;</span>, <span class="string">&quot;shorter&quot;</span>); <span class="comment">// a_string remains</span></span><br><span class="line"><span class="comment">//remove last</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">last_char</span>=a_string.<span class="title function_ invoke__">pop</span>();<span class="comment">//g</span></span><br><span class="line"><span class="comment">//remove nth</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third_char</span>=a_string.<span class="title function_ invoke__">remove</span>(<span class="number">2</span>);<span class="comment">//s</span></span><br><span class="line"><span class="comment">//concate</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">a_b</span>=a_string + &amp;b_string;</span><br><span class="line"></span><br><span class="line"><span class="comment">//escape</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_string</span>=<span class="string">&quot;\x52\x75\x73\74&quot;</span>; <span class="comment">//rust</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_hex</span>=<span class="string">&quot;\\x52\\x75\\x73\\74&quot;</span>; <span class="comment">// \x52\x75\x73\74</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_hex_</span>=r=<span class="string">r#&quot;\x52\x75\x73\74&quot;#</span>;<span class="comment">// \x52\x75\x73\74</span></span><br></pre></td></tr></table></figure>

<h3 id="References-of-a-String"><a href="#References-of-a-String" class="headerlink" title="References of a String"></a>References of a String</h3><h4 id="String-Slice-str"><a href="#String-Slice-str" class="headerlink" title="String Slice (&amp;str)"></a>String Slice (&amp;str)</h4><p>it is referenced to part or the whole String.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">hello_string</span>=Strin::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_part</span>:&amp;<span class="type">str</span> =&amp;hello_string[<span class="number">1</span>..<span class="number">3</span>]; <span class="comment">//&quot;el&quot;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_whole</span>:&amp;<span class="type">str</span> =&amp;hello_string[..]; <span class="comment">//&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//string literal is also a string slice</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_literals</span>:&amp;<span class="type">str</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="String-reference-String"><a href="#String-reference-String" class="headerlink" title="String reference (&amp;String)"></a>String reference (&amp;String)</h4><p>Just like other references, it is just a reference to String.</p>
<h2 id="2-Vectors"><a href="#2-Vectors" class="headerlink" title="2. Vectors"></a>2. Vectors</h2><h3 id="Creating-a-New-Vector"><a href="#Creating-a-New-Vector" class="headerlink" title="Creating a New Vector"></a>Creating a New Vector</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v_1</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">v_1.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">v_2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="Accessing-element"><a href="#Accessing-element" class="headerlink" title="Accessing element"></a>Accessing element</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">sec_num</span>=v_2[<span class="number">1</span>];</span><br><span class="line"><span class="comment">//let panic_num=v_2[3];</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third</span>: <span class="type">Option</span>&lt;&amp;<span class="type">i32</span>&gt;=v_2.<span class="title function_ invoke__">get</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="deleting-elements"><a href="#deleting-elements" class="headerlink" title="deleting elements"></a>deleting elements</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v_2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">last</span>=v2.<span class="title function_ invoke__">pop</span>(); <span class="comment">// remove last element</span></span><br></pre></td></tr></table></figure>

<h3 id="Slice-T"><a href="#Slice-T" class="headerlink" title="Slice &amp;[T]"></a>Slice &amp;[T]</h3><p>The type &amp;[T] is a reference (or pointer) to a slice of data that can reside in either an array or a vector.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">printSlice</span>(slice: &amp;[<span class="type">i32</span>])&#123;</span><br><span class="line">    <span class="built_in">println!</span>&#123;<span class="string">&quot;&#123;&#125;&quot;</span>, slice&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_vec</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_array</span> = [<span class="number">5</span>; <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">printSlice</span>(&amp;my_vec);</span><br><span class="line">    <span class="title function_ invoke__">printSlice</span>(&amp;my_array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-HashMap"><a href="#3-HashMap" class="headerlink" title="3. HashMap"></a>3. HashMap</h2><p>The HashMap does not come with prelude, to use it we need to <code>use std::collections::HashMap;</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">//inserting elements, it is a HashMap&lt;String, i32&gt;</span></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"><span class="comment">//updating elements</span></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">60</span>);</span><br><span class="line"><span class="comment">//getting elements</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name).<span class="title function_ invoke__">copied</span>().<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Hash-Maps-and-Ownership"><a href="#Hash-Maps-and-Ownership" class="headerlink" title="Hash Maps and Ownership"></a>Hash Maps and Ownership</h3><p>For non-Copy types, <code>insert</code> would move the ownership to the map.</p>
<h2 id="4-loop-over-the-collections"><a href="#4-loop-over-the-collections" class="headerlink" title="4. loop over the collections"></a>4. loop over the collections</h2><p><code>for</code> loop will be the choice to loop over the collections</p>
<h3 id="for-each"><a href="#for-each" class="headerlink" title="for each"></a>for each</h3><p><code>for</code> loop will loop over the collections with the iterator of the collections:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for item in iterators&#123;</span></span><br><span class="line"><span class="comment">//     // do something with &#x27;item&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vector</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">nums</span>=<span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> nums.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> &amp;nums &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HashMap</span></span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">map</span> = HashMap::<span class="title function_ invoke__">from</span>([</span><br><span class="line">    (<span class="string">&quot;a&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="string">&quot;b&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    (<span class="string">&quot;c&quot;</span>, <span class="number">3</span>),</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">for</span> (key:&amp;&amp;<span class="type">str</span>, val:&amp;<span class="type">i32</span>) <span class="keyword">in</span> map.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;key: &#123;key&#125; val: &#123;val&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">for</span> (key:&amp;&amp;<span class="type">str</span>, val:&amp;<span class="type">i32</span>) <span class="keyword">in</span> map.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;key: &#123;key&#125; val: &#123;val&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For collections implemented <code>IntoIterator</code>, let’s the type is C,the c.iter() is same as &amp;c.</p>
<h3 id="for-i"><a href="#for-i" class="headerlink" title="for i"></a>for i</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for item in iterators&#123;</span></span><br><span class="line"><span class="comment">//     // do something with &#x27;item&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vector</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">nums</span>=<span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> (i:<span class="type">usize</span>, n:&amp;<span class="type">i32</span>) <span class="keyword">in</span> nums.iter.<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The &#123;&#125;th element is &#123;&#125;&quot;</span>, i, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="for-dealing-with-ownerships"><a href="#for-dealing-with-ownerships" class="headerlink" title="for dealing with ownerships"></a><code>for</code> dealing with ownerships</h3><p>There are three common methods which can create iterators from a collection:</p>
<ul>
<li>iter(), which iterates over &amp;T.</li>
<li>iter_mut(), which iterates over &amp;mut T.</li>
<li>into_iter(), which iterates over T.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/rust-0307-mods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/13/rust-0307-mods/" itemprop="url">Rust lesson 3.7 - Module system</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-13T19:24:13+08:00">
                2024-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Module-system"><a href="#Module-system" class="headerlink" title="Module system"></a>Module system</h1><h2 id="1-crates"><a href="#1-crates" class="headerlink" title="1. crates"></a>1. crates</h2><h3 id="crate-types"><a href="#crate-types" class="headerlink" title="crate types"></a>crate types</h3><ul>
<li>binary crates: Each has a <code>main</code> function, and they are executable.</li>
<li>library crates: No <code>main</code>, similar to dependencies</li>
</ul>
<h2 id="2-packages"><a href="#2-packages" class="headerlink" title="2. packages"></a>2. packages</h2><p>A package contains:</p>
<ul>
<li>a Cargo.toml file</li>
<li>one or more crates(the name of crates is same as package’s name)<ul>
<li>multiple binary crates</li>
<li>a library crate: src&#x2F;lib.rs</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── lib</span><br><span class="line">│           └── a.rs</span><br><span class="line">│           └── b.rs</span><br><span class="line">│       └── main.rs</span><br><span class="line">│       └── lib.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-new-package"><a href="#Creating-a-new-package" class="headerlink" title="Creating a new package"></a>Creating a new package</h3><ul>
<li>binary crate: <code>cargo new &#123;package_name&#125;</code> or <code>cargo new &#123;package_name&#125; --bin</code></li>
<li>library crate: <code>cargo new &#123;package_name&#125; --lib</code></li>
</ul>
<h3 id="external-packages"><a href="#external-packages" class="headerlink" title="external packages"></a>external packages</h3><p>To use external packages, we can add them in the Cargo.toml file, e.g.,<code>rand=&quot;0.8.5&quot;</code>.</p>
<h2 id="3-module"><a href="#3-module" class="headerlink" title="3. module"></a>3. module</h2><h4 id="visibility-of-modules"><a href="#visibility-of-modules" class="headerlink" title="visibility of modules"></a>visibility of modules</h4><ol>
<li><code>mod</code> is private by default, to define a public module use <code>pub mod</code>.</li>
<li>private modules are accessible by its direct parent and submodules</li>
<li><code>use</code> is not ‘import’, it only allows you to have a shorthand without writing the full path. so without the <code>use</code>, the public modules are accessible by their full pathes.</li>
</ol>
<h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h4><p>They are defined in the crate root(either main.rs or library.rs) by keyword <code>mod</code>. And the codes of the modules can be found at following places:</p>
<ul>
<li>inline, <code>&#123;&#125;</code> right after the mod declaration</li>
<li>in the src [mod_name].rs</li>
<li>in the src [mod_name]&#x2F;mod.rs</li>
</ul>
<h4 id="submodules"><a href="#submodules" class="headerlink" title="submodules"></a>submodules</h4><p>They are declared outside the crate root, and the codes of them located in:</p>
<ul>
<li>inline, <code>&#123;&#125;</code> right after the mod declaration</li>
<li>in the src [mod]&#x2F;[sub_mod].rs</li>
<li>in the src [mod]&#x2F;[sub_mod]&#x2F;mod.rs</li>
</ul>
<h2 id="4-workspace"><a href="#4-workspace" class="headerlink" title="4. workspace"></a>4. workspace</h2><p>A workspace is a set of packages that share the same Cargo.lock and output directory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── add_one</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── lib.rs</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>

<p>The packages can be defined in the root Cargo.toml file, and then created by executing <code>cargo new</code> command.<br>And for <code>build</code>, <code>run</code>, and <code>test</code> commands, all the packages will be compiled. Or you can use <code>-p</code> to explicitly run commands in the on one of the packages, e.g., <code>cargo build -p add_one</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/rust-0306-match/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/13/rust-0306-match/" itemprop="url">Rust lesson 3.6 - match</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-13T16:37:15+08:00">
                2024-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="let’s-talk-about-the-ownership-in-match"><a href="#let’s-talk-about-the-ownership-in-match" class="headerlink" title="let’s talk about the ownership in match"></a>let’s talk about the ownership in <code>match</code></h1><h2 id="Bindings-and-ownerships-in-match"><a href="#Bindings-and-ownerships-in-match" class="headerlink" title="Bindings and ownerships in match"></a>Bindings and ownerships in <code>match</code></h2><ol>
<li>Ownship is moved by default<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">t</span>:T = T::<span class="title function_ invoke__">new</span>();</span><br><span class="line"> <span class="keyword">match</span> t &#123;</span><br><span class="line">     _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;processing&quot;</span>),</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// t is moved to the match and can not be accessed</span></span><br><span class="line"> <span class="comment">//println!(&quot;after match t is &#123;:?&#125;&quot;, t)</span></span><br></pre></td></tr></table></figure>
If the T is derived from ‘Copy’, a copy of it is passed to the match, the ownership will not be moved.</li>
<li>Borrowing<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">match</span> &amp;x &#123;</span><br><span class="line">    val =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Matched: &#123;&#125;&quot;</span>, val),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `x` is still accessible here because it was borrowed.</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x is still: &#123;&#125;&quot;</span>, x);</span><br></pre></td></tr></table></figure></li>
<li>Mutable binding<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">match</span> &amp;<span class="keyword">mut</span> x &#123;</span><br><span class="line">    val =&gt; val.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot; world&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `x` has been modified through the mutable reference.</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x is now: &#123;&#125;&quot;</span>, x);</span><br></pre></td></tr></table></figure>
As we mentioned in in the ownership chapter, the exclusive access to <code>x </code>will be return to it after <code>val</code> is out of scope.</li>
</ol>
<h2 id="2-What-about-the-variable-is-an-Option"><a href="#2-What-about-the-variable-is-an-Option" class="headerlink" title="2. What about the variable is an Option"></a>2. What about the variable is an <code>Option</code></h2><p>The “ownership moved by rule” applies to <code>Option</code> as well, we will focus on the value inside.</p>
<ol>
<li><p>Ownship is moved by default</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string); <span class="comment">// my_string is moved to some_string</span></span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">     <span class="comment">// my_string is moved to s1 from some_string</span></span><br><span class="line">    <span class="title function_ invoke__">Some</span>(s1) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//both my_string and some_string are consumed</span></span><br></pre></td></tr></table></figure></li>
<li><p>Borrowing</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(&amp;my_string); <span class="comment">//ref</span></span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(s1: &amp;<span class="type">String</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, my_string);</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string);</span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="keyword">ref</span> s1: &amp;<span class="type">String</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, my_string);</span><br></pre></td></tr></table></figure>

<p><code>ref</code> allows s1 to borrow the inner value of some_string, preventing moving the Option.</p>
</li>
<li><p>Mutable binding</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string);</span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> s1) =&gt; &#123;</span><br><span class="line">        s1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot; world&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, some_string); <span class="comment">//Some(&quot;hello world&quot;)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>The ability to mutate the inner value of a complex type (like Option or Vec) through a mutable reference stems from Rust’s general borrowing rules.</p>
</blockquote>
</li>
</ol>
<p>Based on this, even the my_string is immutable, since some_string is mutable, so the inner value of it is mutable as well.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
