<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/20/rust-0401-Box/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/20/rust-0401-Box/" itemprop="url">Rust lesson 4.1 - Smart Pointer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-20T15:31:53+08:00">
                2024-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introducing-smart-pointer-Box"><a href="#Introducing-smart-pointer-Box" class="headerlink" title="Introducing smart pointer Box&lt;T&gt;"></a>Introducing smart pointer <code>Box&lt;T&gt;</code></h1><h2 id="1-what-is-Box"><a href="#1-what-is-Box" class="headerlink" title="1. what is Box&lt;T&gt;"></a>1. what is <code>Box&lt;T&gt;</code></h2><p><code>Pointer</code>: A variable that contains a address of another variable, e.g., &amp;i32, &amp;[T], etc.</p>
<p><code>Box&lt;T&gt;</code> is no different, it allows us to store data on the heap, and it store a address of the heap.</p>
<h2 id="What-is-it-for"><a href="#What-is-it-for" class="headerlink" title="What is it for"></a>What is it for</h2><h3 id="1-Storing-data-on-the-heap"><a href="#1-Storing-data-on-the-heap" class="headerlink" title="1. Storing data on the heap"></a>1. Storing data on the heap</h3><p>In the following example, we store 5 on the heap instead of stack.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b = &#123;b&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Enabling-Recursive-types"><a href="#2-Enabling-Recursive-types" class="headerlink" title="2. Enabling Recursive types"></a>2. Enabling Recursive types</h3><p>The following enum is not valid in rust. Previously, we have discussed the memory layout of enum, we learnt that the size of the enum depends on the largest variant b. The <code>List</code> here is a recursize type, there is no way to know the size of it, the Rust would assume the size of it is infinite.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32, List), //wrong</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, the size of <code>Box&lt;T&gt;</code> is fixed, it enables us to use recursive types like</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Featurs-of-a-smart-pointer"><a href="#Featurs-of-a-smart-pointer" class="headerlink" title="Featurs of a smart pointer"></a>Featurs of a smart pointer</h2><h3 id="Dereference-using-Deref-Trait"><a href="#Dereference-using-Deref-Trait" class="headerlink" title="Dereference using Deref Trait"></a>Dereference using <code>Deref</code> Trait</h3><p><code>Box&lt;T&gt;</code> implements <code>Deref</code> trait which provides a function <code>deref</code> that would return the &amp;T:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Deref;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Deref <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">Self</span>::Target &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.<span class="number">0</span> <span class="comment">//MyBox is a tuple struct</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>*y</code> would be subsitutes the ‘_‘ with a call to <code>deref</code> by rust:</p>
<p><code>*y</code> &#x3D;&gt; <code>*(y.deref())</code> &#x3D;&gt; <code>*(&amp;x)</code>&#x3D;&gt;<code>x</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mutable-reference-with-DerefMut"><a href="#Mutable-reference-with-DerefMut" class="headerlink" title="Mutable reference with DerefMut"></a>Mutable reference with <code>DerefMut</code></h3><p>Similar to <code>Deref</code>, <code>DerefMut</code> provides a <code>deref_mut</code> function return a mutable reference of T:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::DerefMut;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; DerefMut <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref_mut</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span>::Target &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.<span class="number">0</span> <span class="comment">//MyBox is a tuple struct</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Cleanup-automatically"><a href="#Cleanup-automatically" class="headerlink" title="Cleanup automatically"></a>Cleanup automatically</h3><p><code>Box&lt;T&gt;</code> also implements <code>Drop</code> trait, witch provides a <code>drop</code> allowing customizeable actions when a value is about to out of scope.</p>
<p>In terms of <code>Box&lt;T&gt;</code>, the <code>drop</code> is set to deallocate the space on the heap that the box points to.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/16/rust-0308-collections/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/16/rust-0308-collections/" itemprop="url">Rust lesson 3.8 - Collections</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-16T20:55:47+08:00">
                2024-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introducing-commonly-used-collections"><a href="#Introducing-commonly-used-collections" class="headerlink" title="Introducing commonly used collections"></a>Introducing commonly used collections</h1><h2 id="1-String"><a href="#1-String" class="headerlink" title="1. String"></a>1. String</h2><h3 id="Creating-a-string"><a href="#Creating-a-string" class="headerlink" title="Creating a string"></a>Creating a string</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a emtpy string</span></span><br><span class="line"><span class="type">String</span> a_string = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">//create a string with string literals</span></span><br><span class="line"><span class="type">String</span> b_string= <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;b string&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="String-manipulation"><a href="#String-manipulation" class="headerlink" title="String manipulation"></a>String manipulation</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//append</span></span><br><span class="line">a_string.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">//a</span></span><br><span class="line">a_string.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;string&quot;</span>); <span class="comment">// astring</span></span><br><span class="line"><span class="comment">//insert</span></span><br><span class="line">a_string.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>,<span class="string">&#x27; &#x27;</span>); <span class="comment">// a string</span></span><br><span class="line">a_string.<span class="title function_ invoke__">insert_str</span>(<span class="number">2</span>,<span class="string">&quot;longer &quot;</span>); <span class="comment">// a longer string</span></span><br><span class="line"><span class="comment">//replace</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">shorter</span>=a_string.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;longer&quot;</span>, <span class="string">&quot;shorter&quot;</span>); <span class="comment">// a_string remains</span></span><br><span class="line"><span class="comment">//remove last</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">last_char</span>=a_string.<span class="title function_ invoke__">pop</span>();<span class="comment">//g</span></span><br><span class="line"><span class="comment">//remove nth</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third_char</span>=a_string.<span class="title function_ invoke__">remove</span>(<span class="number">2</span>);<span class="comment">//s</span></span><br><span class="line"><span class="comment">//concate</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">a_b</span>=a_string + &amp;b_string;</span><br><span class="line"></span><br><span class="line"><span class="comment">//escape</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_string</span>=<span class="string">&quot;\x52\x75\x73\74&quot;</span>; <span class="comment">//rust</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_hex</span>=<span class="string">&quot;\\x52\\x75\\x73\\74&quot;</span>; <span class="comment">// \x52\x75\x73\74</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rust_hex_</span>=r=<span class="string">r#&quot;\x52\x75\x73\74&quot;#</span>;<span class="comment">// \x52\x75\x73\74</span></span><br></pre></td></tr></table></figure>

<h3 id="References-of-a-String"><a href="#References-of-a-String" class="headerlink" title="References of a String"></a>References of a String</h3><h4 id="String-Slice-str"><a href="#String-Slice-str" class="headerlink" title="String Slice (&amp;str)"></a>String Slice (&amp;str)</h4><p>it is referenced to part or the whole String.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">hello_string</span>=Strin::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_part</span>:&amp;<span class="type">str</span> =&amp;hello_string[<span class="number">1</span>..<span class="number">3</span>]; <span class="comment">//&quot;el&quot;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_whole</span>:&amp;<span class="type">str</span> =&amp;hello_string[..]; <span class="comment">//&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//string literal is also a string slice</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_literals</span>:&amp;<span class="type">str</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="String-reference-String"><a href="#String-reference-String" class="headerlink" title="String reference (&amp;String)"></a>String reference (&amp;String)</h4><p>Just like other references, it is just a reference to String.</p>
<h2 id="2-Vectors"><a href="#2-Vectors" class="headerlink" title="2. Vectors"></a>2. Vectors</h2><h3 id="Creating-a-New-Vector"><a href="#Creating-a-New-Vector" class="headerlink" title="Creating a New Vector"></a>Creating a New Vector</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v_1</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">v_1.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">v_2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="Accessing-element"><a href="#Accessing-element" class="headerlink" title="Accessing element"></a>Accessing element</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">sec_num</span>=v_2[<span class="number">1</span>];</span><br><span class="line"><span class="comment">//let panic_num=v_2[3];</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third</span>: <span class="type">Option</span>&lt;&amp;<span class="type">i32</span>&gt;=v_2.<span class="title function_ invoke__">get</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="deleting-elements"><a href="#deleting-elements" class="headerlink" title="deleting elements"></a>deleting elements</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v_2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">last</span>=v2.<span class="title function_ invoke__">pop</span>(); <span class="comment">// remove last element</span></span><br></pre></td></tr></table></figure>

<h3 id="Slice-T"><a href="#Slice-T" class="headerlink" title="Slice &amp;[T]"></a>Slice &amp;[T]</h3><p>The type &amp;[T] is a reference (or pointer) to a slice of data that can reside in either an array or a vector.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">printSlice</span>(slice: &amp;[<span class="type">i32</span>])&#123;</span><br><span class="line">    <span class="built_in">println!</span>&#123;<span class="string">&quot;&#123;&#125;&quot;</span>, slice&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_vec</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_array</span> = [<span class="number">5</span>; <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">printSlice</span>(&amp;my_vec);</span><br><span class="line">    <span class="title function_ invoke__">printSlice</span>(&amp;my_array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-HashMap"><a href="#3-HashMap" class="headerlink" title="3. HashMap"></a>3. HashMap</h2><p>The HashMap does not come with prelude, to use it we need to <code>use std::collections::HashMap;</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">//inserting elements, it is a HashMap&lt;String, i32&gt;</span></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"><span class="comment">//updating elements</span></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">60</span>);</span><br><span class="line"><span class="comment">//getting elements</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name).<span class="title function_ invoke__">copied</span>().<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Hash-Maps-and-Ownership"><a href="#Hash-Maps-and-Ownership" class="headerlink" title="Hash Maps and Ownership"></a>Hash Maps and Ownership</h3><p>For non-Copy types, <code>insert</code> would move the ownership to the map.</p>
<h2 id="4-loop-over-the-collections"><a href="#4-loop-over-the-collections" class="headerlink" title="4. loop over the collections"></a>4. loop over the collections</h2><p><code>for</code> loop will be the choice to loop over the collections</p>
<h3 id="for-each"><a href="#for-each" class="headerlink" title="for each"></a>for each</h3><p><code>for</code> loop will loop over the collections with the iterator of the collections:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for item in iterators&#123;</span></span><br><span class="line"><span class="comment">//     // do something with &#x27;item&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vector</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">nums</span>=<span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> nums.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> &amp;nums &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HashMap</span></span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">map</span> = HashMap::<span class="title function_ invoke__">from</span>([</span><br><span class="line">    (<span class="string">&quot;a&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="string">&quot;b&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    (<span class="string">&quot;c&quot;</span>, <span class="number">3</span>),</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">for</span> (key:&amp;&amp;<span class="type">str</span>, val:&amp;<span class="type">i32</span>) <span class="keyword">in</span> map.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;key: &#123;key&#125; val: &#123;val&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">for</span> (key:&amp;&amp;<span class="type">str</span>, val:&amp;<span class="type">i32</span>) <span class="keyword">in</span> map.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;key: &#123;key&#125; val: &#123;val&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For collections implemented <code>IntoIterator</code>, let’s the type is C,the c.iter() is same as &amp;c.</p>
<h3 id="for-i"><a href="#for-i" class="headerlink" title="for i"></a>for i</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for item in iterators&#123;</span></span><br><span class="line"><span class="comment">//     // do something with &#x27;item&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vector</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">nums</span>=<span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> (i:<span class="type">usize</span>, n:&amp;<span class="type">i32</span>) <span class="keyword">in</span> nums.iter.<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The &#123;&#125;th element is &#123;&#125;&quot;</span>, i, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="for-dealing-with-ownerships"><a href="#for-dealing-with-ownerships" class="headerlink" title="for dealing with ownerships"></a><code>for</code> dealing with ownerships</h3><p>There are three common methods which can create iterators from a collection:</p>
<ul>
<li>iter(), which iterates over &amp;T.</li>
<li>iter_mut(), which iterates over &amp;mut T.</li>
<li>into_iter(), which iterates over T.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/rust-0307-mods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/13/rust-0307-mods/" itemprop="url">Rust lesson 3.7 - Module system</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-13T19:24:13+08:00">
                2024-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Module-system"><a href="#Module-system" class="headerlink" title="Module system"></a>Module system</h1><h2 id="1-crates"><a href="#1-crates" class="headerlink" title="1. crates"></a>1. crates</h2><h3 id="crate-types"><a href="#crate-types" class="headerlink" title="crate types"></a>crate types</h3><ul>
<li>binary crates: Each has a <code>main</code> function, and they are executable.</li>
<li>library crates: No <code>main</code>, similar to dependencies</li>
</ul>
<h2 id="2-packages"><a href="#2-packages" class="headerlink" title="2. packages"></a>2. packages</h2><p>A package contains:</p>
<ul>
<li>a Cargo.toml file</li>
<li>one or more crates(the name of crates is same as package’s name)<ul>
<li>multiple binary crates</li>
<li>a library crate: src&#x2F;lib.rs</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── lib</span><br><span class="line">│           └── a.rs</span><br><span class="line">│           └── b.rs</span><br><span class="line">│       └── main.rs</span><br><span class="line">│       └── lib.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-new-package"><a href="#Creating-a-new-package" class="headerlink" title="Creating a new package"></a>Creating a new package</h3><ul>
<li>binary crate: <code>cargo new &#123;package_name&#125;</code> or <code>cargo new &#123;package_name&#125; --bin</code></li>
<li>library crate: <code>cargo new &#123;package_name&#125; --lib</code></li>
</ul>
<h3 id="external-packages"><a href="#external-packages" class="headerlink" title="external packages"></a>external packages</h3><p>To use external packages, we can add them in the Cargo.toml file, e.g.,<code>rand=&quot;0.8.5&quot;</code>.</p>
<h2 id="3-module"><a href="#3-module" class="headerlink" title="3. module"></a>3. module</h2><h4 id="visibility-of-modules"><a href="#visibility-of-modules" class="headerlink" title="visibility of modules"></a>visibility of modules</h4><ol>
<li><code>mod</code> is private by default, to define a public module use <code>pub mod</code>.</li>
<li>private modules are accessible by its direct parent and submodules</li>
<li><code>use</code> is not ‘import’, it only allows you to have a shorthand without writing the full path. so without the <code>use</code>, the public modules are accessible by their full pathes.</li>
</ol>
<h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h4><p>They are defined in the crate root(either main.rs or library.rs) by keyword <code>mod</code>. And the codes of the modules can be found at following places:</p>
<ul>
<li>inline, <code>&#123;&#125;</code> right after the mod declaration</li>
<li>in the src [mod_name].rs</li>
<li>in the src [mod_name]&#x2F;mod.rs</li>
</ul>
<h4 id="submodules"><a href="#submodules" class="headerlink" title="submodules"></a>submodules</h4><p>They are declared outside the crate root, and the codes of them located in:</p>
<ul>
<li>inline, <code>&#123;&#125;</code> right after the mod declaration</li>
<li>in the src [mod]&#x2F;[sub_mod].rs</li>
<li>in the src [mod]&#x2F;[sub_mod]&#x2F;mod.rs</li>
</ul>
<h2 id="4-workspace"><a href="#4-workspace" class="headerlink" title="4. workspace"></a>4. workspace</h2><p>A workspace is a set of packages that share the same Cargo.lock and output directory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── add_one</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── lib.rs</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>

<p>The packages can be defined in the root Cargo.toml file, and then created by executing <code>cargo new</code> command.<br>And for <code>build</code>, <code>run</code>, and <code>test</code> commands, all the packages will be compiled. Or you can use <code>-p</code> to explicitly run commands in the on one of the packages, e.g., <code>cargo build -p add_one</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/rust-0306-match/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/13/rust-0306-match/" itemprop="url">Rust lesson 3.6 - match</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-13T16:37:15+08:00">
                2024-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="let’s-talk-about-the-ownership-in-match"><a href="#let’s-talk-about-the-ownership-in-match" class="headerlink" title="let’s talk about the ownership in match"></a>let’s talk about the ownership in <code>match</code></h1><h2 id="Bindings-and-ownerships-in-match"><a href="#Bindings-and-ownerships-in-match" class="headerlink" title="Bindings and ownerships in match"></a>Bindings and ownerships in <code>match</code></h2><ol>
<li>Ownship is moved by default<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">t</span>:T = T::<span class="title function_ invoke__">new</span>();</span><br><span class="line"> <span class="keyword">match</span> t &#123;</span><br><span class="line">     _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;processing&quot;</span>),</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// t is moved to the match and can not be accessed</span></span><br><span class="line"> <span class="comment">//println!(&quot;after match t is &#123;:?&#125;&quot;, t)</span></span><br></pre></td></tr></table></figure>
If the T is derived from ‘Copy’, a copy of it is passed to the match, the ownership will not be moved.</li>
<li>Borrowing<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">match</span> &amp;x &#123;</span><br><span class="line">    val =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Matched: &#123;&#125;&quot;</span>, val),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `x` is still accessible here because it was borrowed.</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x is still: &#123;&#125;&quot;</span>, x);</span><br></pre></td></tr></table></figure></li>
<li>Mutable binding<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">match</span> &amp;<span class="keyword">mut</span> x &#123;</span><br><span class="line">    val =&gt; val.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot; world&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `x` has been modified through the mutable reference.</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x is now: &#123;&#125;&quot;</span>, x);</span><br></pre></td></tr></table></figure>
As we mentioned in in the ownership chapter, the exclusive access to <code>x </code>will be return to it after <code>val</code> is out of scope.</li>
</ol>
<h2 id="2-What-about-the-variable-is-an-Option"><a href="#2-What-about-the-variable-is-an-Option" class="headerlink" title="2. What about the variable is an Option"></a>2. What about the variable is an <code>Option</code></h2><p>The “ownership moved by rule” applies to <code>Option</code> as well, we will focus on the value inside.</p>
<ol>
<li><p>Ownship is moved by default</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string); <span class="comment">// my_string is moved to some_string</span></span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">     <span class="comment">// my_string is moved to s1 from some_string</span></span><br><span class="line">    <span class="title function_ invoke__">Some</span>(s1) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//both my_string and some_string are consumed</span></span><br></pre></td></tr></table></figure></li>
<li><p>Borrowing</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(&amp;my_string); <span class="comment">//ref</span></span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(s1: &amp;<span class="type">String</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, my_string);</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string);</span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="keyword">ref</span> s1: &amp;<span class="type">String</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, my_string);</span><br></pre></td></tr></table></figure>

<p><code>ref</code> allows s1 to borrow the inner value of some_string, preventing moving the Option.</p>
</li>
<li><p>Mutable binding</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">some_string</span> = <span class="title function_ invoke__">Some</span>(my_string);</span><br><span class="line"><span class="keyword">match</span> some_string &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> s1) =&gt; &#123;</span><br><span class="line">        s1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot; world&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;the value is &#123;&#125;&quot;</span>, s1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;nothing here&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;some_string is &#123;:?&#125;&quot;</span>, some_string); <span class="comment">//Some(&quot;hello world&quot;)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>The ability to mutate the inner value of a complex type (like Option or Vec) through a mutable reference stems from Rust’s general borrowing rules.</p>
</blockquote>
</li>
</ol>
<p>Based on this, even the my_string is immutable, since some_string is mutable, so the inner value of it is mutable as well.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/10/rust-0305-enum2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/10/rust-0305-enum2/" itemprop="url">Rust lesson 3.5 - Option and Result</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-10T21:50:41+08:00">
                2024-10-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Option-and-Result"><a href="#Option-and-Result" class="headerlink" title="Option and Result"></a>Option and Result</h1><h2 id="1-Option"><a href="#1-Option" class="headerlink" title="1. Option&lt;T&gt;"></a>1. <code>Option&lt;T&gt;</code></h2><p>There is no concept of ‘NULL’ in rust, and it is not a good practice anyway. <code>Option&lt;T&gt;</code> is came up to represent the two opposite status of the T: present(<code>Some(t)</code>) and absent (<code>None</code>).</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">some_number</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_char</span> = <span class="title function_ invoke__">Some</span>(<span class="string">&#x27;e&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_number</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Common-used-methods-of-Option"><a href="#Common-used-methods-of-Option" class="headerlink" title="Common used methods of Option"></a>Common used methods of Option</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//unwrap()</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_number</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_value</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>; <span class="comment">// this will not panic now</span></span><br><span class="line"><span class="comment">// println!(</span></span><br><span class="line"><span class="comment">//     &quot;This will panic since value &#123;&#125; is absent&quot;,</span></span><br><span class="line"><span class="comment">//     absent_value.unwrap()</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//expect()</span></span><br><span class="line"><span class="comment">// println!(</span></span><br><span class="line"><span class="comment">//     &quot;This will never be displayed &#123;&#125;&quot;,</span></span><br><span class="line"><span class="comment">//     absent_value.expect(&quot;panic more verbose&quot;)</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//is_some() and is_none() are opposite</span></span><br><span class="line"><span class="keyword">if</span> some_number.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;some is &#123;&#125;&quot;</span>, some_number.<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//map() allows to process the value and return the result, the &#x27;result&#x27; and the &#x27;value&#x27; can be different types</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">simple_string</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span>: <span class="type">Option</span>&lt;<span class="type">usize</span>&gt; = simple_string.<span class="title function_ invoke__">map</span>(|s| s.<span class="title function_ invoke__">len</span>()); <span class="comment">// len is 3</span></span><br><span class="line"><span class="built_in">assert_eq!</span>(len, <span class="title function_ invoke__">Some</span>(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_string</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span>: <span class="type">Option</span>&lt;<span class="type">usize</span>&gt; = absent_string.<span class="title function_ invoke__">map</span>(|s| s.<span class="title function_ invoke__">len</span>()); <span class="comment">// len is None</span></span><br><span class="line"><span class="built_in">assert_eq!</span>(len, <span class="literal">None</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2-Result"><a href="#2-Result" class="headerlink" title="2. Result&lt;T&gt;"></a>2. <code>Result&lt;T&gt;</code></h2><p>Most errors aren’t serious enough to require the program to stop entirely. e.g., wrong password from a user should not stop the program.</p>
<p>Result enum is defined as having two variants, Ok and Err, as follows:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>T: the type of the value that will be returned in a success case</li>
<li>E: the type of the error that will be returned in a failure case</li>
</ul>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">greeting_file_result</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">greeting_file</span> = <span class="keyword">match</span> greeting_file_result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;error:?&#125;&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, T is <code>File</code> and E is <code>String</code>.</p>
<p>In most cases, the <code>Result</code> is used as a return type to propagate the result to the function caller as follows:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Read&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">username_file_result</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">username_file</span> = <span class="keyword">match</span> username_file_result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="as-a-shorthand-for-result-propagation"><a href="#as-a-shorthand-for-result-propagation" class="headerlink" title="? as a shorthand for result propagation"></a><code>? </code>as a shorthand for result propagation</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">username</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="comment">// if there is an error, the &#x27;?&#x27; would propagate it, continue execution otherwise.</span></span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> username)?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(username)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Common-used-methods-of-Result"><a href="#Common-used-methods-of-Result" class="headerlink" title="Common used methods of Result"></a>Common used methods of Result</h3><p>As you can see they are quite similar to the Option’s methods.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">some_number</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_value</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;This is error&quot;</span>);</span><br><span class="line"><span class="comment">//this will panic!</span></span><br><span class="line"><span class="comment">// println!(</span></span><br><span class="line"><span class="comment">//     &quot;This will panic since value &#123;&#125; is absent&quot;,</span></span><br><span class="line"><span class="comment">//     absent_value.unwrap()</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//expect()</span></span><br><span class="line"><span class="comment">// println!(</span></span><br><span class="line"><span class="comment">//     &quot;This will never be displayed &#123;&#125;&quot;,</span></span><br><span class="line"><span class="comment">//     absent_value.expect(&quot;panic more verbose&quot;)</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//is_some() and is_none() are opposite</span></span><br><span class="line"><span class="keyword">if</span> some_number.<span class="title function_ invoke__">is_ok</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;some is &#123;&#125;&quot;</span>, some_number.<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//map() allows to process the value and return the result, the &#x27;result&#x27; and the &#x27;value&#x27; can be different types</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">simple_string</span> = <span class="title function_ invoke__">Ok</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span>: <span class="type">Result</span>&lt;<span class="type">usize</span>, &amp;<span class="type">str</span>&gt; = simple_string.<span class="title function_ invoke__">map</span>(|s| s.<span class="title function_ invoke__">len</span>()); <span class="comment">// len is 3</span></span><br><span class="line"><span class="built_in">assert_eq!</span>(len, <span class="title function_ invoke__">Ok</span>(<span class="number">3</span> <span class="keyword">as</span> <span class="type">usize</span>));</span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_string</span>: <span class="type">Result</span>&lt;<span class="type">String</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;This is not a string&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = absent_string.<span class="title function_ invoke__">map</span>(|s| s.<span class="title function_ invoke__">len</span>());</span><br><span class="line"><span class="built_in">assert_eq!</span>(len, <span class="title function_ invoke__">Err</span>(<span class="string">&quot;This is not a string&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-Conversion-between-Option-and-Result"><a href="#3-Conversion-between-Option-and-Result" class="headerlink" title="3. Conversion between Option and Result"></a>3. Conversion between Option and Result</h2><h3 id="3-1-Option-Result"><a href="#3-1-Option-Result" class="headerlink" title="3.1 Option &#x3D;&gt; Result"></a>3.1 Option &#x3D;&gt; Result</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = opt.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;Error: no value found&quot;</span>);<span class="comment">// res is Ok(42)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = opt.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;Error: no value found&quot;</span>);<span class="comment">// res is Err(&quot;Error: no value found&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, <span class="type">String</span>&gt; = opt.<span class="title function_ invoke__">ok_or_else</span>(|| <span class="string">&quot;Generated error&quot;</span>.<span class="title function_ invoke__">to_string</span>());<span class="comment">// res is Err(&quot;Generated error&quot;)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-Result-Option"><a href="#3-2-Result-Option" class="headerlink" title="3.2 Result &#x3D;&gt; Option"></a>3.2 Result &#x3D;&gt; Option</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = res.<span class="title function_ invoke__">ok</span>();<span class="comment">// opt is Some(42)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;An error occurred&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = res.<span class="title function_ invoke__">ok</span>();<span class="comment">// opt is None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;An error occurred&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;&amp;<span class="type">str</span>&gt; = res.<span class="title function_ invoke__">err</span>();<span class="comment">// opt is Some(&quot;An error occurred&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;&amp;<span class="type">str</span>&gt; = res.<span class="title function_ invoke__">err</span>();<span class="comment">// opt is None</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/09/rust-0304-enum/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/09/rust-0304-enum/" itemprop="url">Rust lesson 3.4 - Enum</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-09T20:28:32+08:00">
                2024-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Enum-101"><a href="#Enum-101" class="headerlink" title="Enum 101"></a>Enum 101</h1><h2 id="1-Defining-an-Enum"><a href="#1-Defining-an-Enum" class="headerlink" title="1. Defining an Enum"></a>1. Defining an Enum</h2><p>Enum allows you to define a set of values.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;, <span class="comment">// like a struct</span></span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>), <span class="comment">// string</span></span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>), <span class="comment">// tuple</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Memory-layout-of-enums"><a href="#Memory-layout-of-enums" class="headerlink" title="Memory layout of enums"></a>Memory layout of enums</h2><ol>
<li>Discriminant(1 byte*):<ul>
<li>Rust stores a discriminant for each enum. This is an integer representing which variant is currently active.(Quit: 0, Move: 1…)</li>
<li>By default, Rust uses a u8 for the discriminant, as long as the enum has fewer than 256 variants.<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. In this example, there are no variants.However, the size of it is 2 bytes, because the discriminant is more than 255</span></span><br><span class="line">   <span class="keyword">enum</span> <span class="title class_">EnumA</span> &#123;</span><br><span class="line">       A = <span class="number">255</span>,</span><br><span class="line">       B,</span><br><span class="line">   <span class="comment">// B&#x27;s discriminant is 256, since the discriminant values</span></span><br><span class="line">   <span class="comment">//are typically consecutive integers</span></span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//2. In this example, the size of EnumB is 0, because of Single-variant enum optimization</span></span><br><span class="line">   <span class="keyword">enum</span> <span class="title class_">EnumB</span> &#123;</span><br><span class="line">       A = <span class="number">256</span>,</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Variants<ul>
<li>this is the size of the variant’s value, e.g., <code>Move</code> has two i32 values, each of which is 4bytes, 8bytes in total.</li>
<li>Rust will align the enum to the size of its largest variant for efficient access.</li>
</ul>
</li>
</ol>
<p>In Rust, the size of an enum is typically determined by its largest variant. For example, consider an enum <code>Message</code> that includes variants such as <code>Write</code>, <code>Quit</code>, and <code>Move</code>.</p>
<ul>
<li>The <code>Write</code> variant might consist of a discriminant (usually 1 byte) and a <code>String</code> (which may vary in size, but let’s assume it uses 24 bytes for this explanation). Therefore, theoretically, the size of <code>Message</code> could be expected to be 25 bytes.</li>
</ul>
<p><strong>However</strong>, in practice, Rust uses a technique known as <strong>niche optimization</strong>. This means that if some of the variants are small or can share memory efficiently, the Rust compiler can optimize the size of the enum.</p>
<p>For instance, because the <code>Quit</code> and <code>Move</code> variants are small and can be represented with fewer bits, the actual size of the <code>Message</code> enum may be reduced to 24 bytes instead of the expected 25. This optimization allows Rust to pack these variants more efficiently in memory, thus saving space.</p>
<p>The size of a String</p>
<ul>
<li>a pointer:8 bytes on a 64-bit system</li>
<li>length: 8 bytes</li>
<li>capacity: 8 bytes</li>
</ul>
<h2 id="2-Option-and-Result"><a href="#2-Option-and-Result" class="headerlink" title="2. Option and Result"></a>2. Option and Result</h2><p>They enums defined by the standard library.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-match-Control-Flow"><a href="#3-match-Control-Flow" class="headerlink" title="3. match Control Flow"></a>3. match Control Flow</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value_in_cents</span>(coin: Coin) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::Penny =&gt; <span class="number">1</span>,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There are some important features of match:</p>
<ul>
<li>Catch-all pattern: the match arms need to cover all possible value, if we don’t want to list all: we can use a special pattern:<ul>
<li><code>other</code>: match other possible value</li>
<li><code>-</code>: match any value</li>
</ul>
</li>
<li><code>match</code> is also an expression and can be used to value assignment</li>
<li><code>match</code> can be used with non-enum types as well</li>
</ul>
<h2 id="4-if-let"><a href="#4-if-let" class="headerlink" title="4. if let"></a>4. <code>if let</code></h2><p>A concise version of <code>match</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//using match</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">match</span> coin &#123;</span><br><span class="line">    Coin::<span class="title function_ invoke__">Quarter</span>(state) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;State quarter from &#123;state:?&#125;!&quot;</span>),</span><br><span class="line">    _ =&gt; count += <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//using if let</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Coin</span>::<span class="title function_ invoke__">Quarter</span>(state) = coin &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;State quarter from &#123;state:?&#125;!&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    count += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0303-functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0303-functions/" itemprop="url">Rust lesson 3.3 - Functions</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T21:45:53+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Functions-and-Methods"><a href="#Functions-and-Methods" class="headerlink" title="Functions and Methods"></a>Functions and Methods</h1><h2 id="1-Functions"><a href="#1-Functions" class="headerlink" title="1. Functions"></a>1. Functions</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fn</code> keyword</li>
<li>function name: plus_one</li>
<li><code>x</code> is the parameter, and type of it need be defined explicitly.</li>
<li><code>-&gt;</code> tells the return type is i32</li>
<li><code>x+1</code> is an expression, identical to <code>return x+1;</code></li>
</ul>
<h2 id="2-Methods"><a href="#2-Methods" class="headerlink" title="2. Methods"></a>2. Methods</h2><p>Methods are similar to functions, while theys are defined within the context of a struct (or an enum or a trait object), and their first parameter is always <strong>self</strong>, which represents the instance of the struct the method is being called on.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width * <span class="keyword">self</span>.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123;</span><br><span class="line">        width: <span class="number">30</span>,</span><br><span class="line">        height: <span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;The area of the rectangle is &#123;&#125; square pixels.&quot;</span>,</span><br><span class="line">        rect1.<span class="title function_ invoke__">area</span>()</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Associated-Methods"><a href="#3-Associated-Methods" class="headerlink" title="3. Associated Methods"></a>3. Associated Methods</h2><p>They are functions associated with a type but not tied to any particular instance of that type.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    radius: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="comment">// Associated function (static-like method)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Circle &#123; radius &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">pi</span>() <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="number">3.1415</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Method that takes `self` (instance method)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="number">3.1415</span> * <span class="keyword">self</span>.radius * <span class="keyword">self</span>.radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Calling the associated function</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle</span> = Circle::<span class="title function_ invoke__">new</span>(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calling an instance method on the created instance</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The area of the circle is &#123;&#125;&quot;</span>, circle.<span class="title function_ invoke__">area</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The PI is &#123;&#125;&quot;</span>, Circle::<span class="title function_ invoke__">pi</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Trait"><a href="#4-Trait" class="headerlink" title="4. Trait"></a>4. Trait</h2><p>Traits can be used to define shared behavior in an abstract way. They are similar to the idea of ‘interfaces’ in other programming languages.</p>
<h3 id="4-1-Defining-a-trait"><a href="#4-1-Defining-a-trait" class="headerlink" title="4.1 Defining a trait"></a>4.1 Defining a trait</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">    <span class="comment">//method with default implementation</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summary_type</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">        <span class="string">&quot;This is beliong to Summary type&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Implementing-a-trait-on-a-type"><a href="#4-2-Implementing-a-trait-on-a-type" class="headerlink" title="4.2 Implementing a trait on a type"></a>4.2 Implementing a trait on a type</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Trait-Bound-Syntax"><a href="#4-3-Trait-Bound-Syntax" class="headerlink" title="4.3 Trait Bound Syntax"></a>4.3 Trait Bound Syntax</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// is same as:</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//to narrow down with multiple traits:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br><span class="line"><span class="comment">//or:</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span>+ Display)) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Control-flows"><a href="#5-Control-flows" class="headerlink" title="5, Control flows"></a>5, Control flows</h2><p>We will cover <code>if</code>, <code>loop</code>, and <code>while loop</code> in the following sections:</p>
<h3 id="5-1-if"><a href="#5-1-if" class="headerlink" title="5,1 if"></a>5,1 <code>if</code></h3><p><code>if</code> is quite simple, the only thing worth notcing is that the <code>condition</code> has to be a <code>bool</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 4&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 3&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 2&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is not divisible by 4, 3, or 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if</code> can be used as an expression, e.g.,<br>let number &#x3D; if true { 1 } else {0};</p>
<h3 id="5-2-loop"><a href="#5-2-loop" class="headerlink" title="5.2 loop"></a>5.2 loop</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">num</span>=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> num&lt;<span class="number">10</span> &#123;</span><br><span class="line">        num+=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;num is 10 now&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using loop label to continue or break to specified loop:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">&#x27;counting_up</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remaining</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> remaining == <span class="number">9</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">&#x27;counting_up</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Similar to <code>if</code>, loop can be used as an expression as well.</p>
<h3 id="5-3-while-loop"><a href="#5-3-while-loop" class="headerlink" title="5.3 while loop"></a>5.3 while loop</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> index &lt; <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;the value is: &#123;&#125;&quot;</span>, a[index]);</span><br><span class="line"></span><br><span class="line">    index += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0302-ownership/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0302-ownership/" itemprop="url">Rust lesson 3.2 - Ownership and reference</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T21:04:40+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Understanding-ownership"><a href="#Target-Understanding-ownership" class="headerlink" title="Target: Understanding ownership"></a>Target: Understanding ownership</h1><h2 id="1-Ownership"><a href="#1-Ownership" class="headerlink" title="1. Ownership"></a>1. Ownership</h2><h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><ul>
<li><p>Each value in Rust has an owner.</p>
<p><code>let my_string = String::from(&quot;abc&quot;);</code> my_string is the owner of the string.</p>
</li>
<li><p>There can only be one owner at a time.</p>
<p><code>let str1 = my_string;</code> str1 is the owner, and my_string is no longer valid.</p>
</li>
<li><p>When the owner goes out of scope, the value will be dropped.</p>
<p><code>&#123;&#125;</code> defines the scope; the variable is no longer valid outside its scope.</p>
</li>
</ul>
<h2 id="2-Reference"><a href="#2-Reference" class="headerlink" title="2. Reference"></a>2. Reference</h2><p>Reference: accessing a variable without changing the ownership.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">abc_owner</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">abc_ref</span> = &amp;abc_owner; <span class="comment">// abc_ref is a reference. abc_owner is still the owner.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">efg_owner</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;efg&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">efg_ref</span> = &amp;<span class="keyword">mut</span> efg_owner; <span class="comment">// efg_ref is a mutable reference.</span></span><br><span class="line">efg_ref.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;hik&quot;</span>); <span class="comment">// efg_owner is now &quot;efghik&quot;.</span></span><br></pre></td></tr></table></figure>

<h3 id="Limitation-of-Reference"><a href="#Limitation-of-Reference" class="headerlink" title="Limitation of Reference"></a>Limitation of Reference</h3><p>The rule of reference is quite similar to read&#x2F;write lock:<br>A variable can have 1 ‘&amp;mut’ reference or multiple ‘&amp;’ reference.</p>
<h3 id="Scope-of-references"><a href="#Scope-of-references" class="headerlink" title="Scope of references"></a>Scope of references</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span>=<span class="type">String</span>::fr <span class="title function_ invoke__">om</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">r1</span>=&amp;s;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">r2</span>=&amp;s;</span><br><span class="line"><span class="built_in">println!</span>&#123;<span class="string">&quot;&#123;r1&#125; and &#123;r2&#125;&quot;</span>&#125;; <span class="comment">//r1 and r2 are no longer refered after this</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r3</span> = &amp;<span class="keyword">mut</span> s; <span class="comment">//r3 is the only ref of s</span></span><br><span class="line"><span class="title function_ invoke__">println</span>(<span class="string">&quot;&#123;r3&#125;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-Variables-in-memory"><a href="#3-Variables-in-memory" class="headerlink" title="3. Variables in memory"></a>3. Variables in memory</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span>=x;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x = &#123;x&#125;, y = &#123;y&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>=<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>=s2</span><br><span class="line"><span class="comment">//println!(&quot;s1 = &#123;s1&#125;, s2 = &#123;s2&#125;&quot;); s1 is not valid here</span></span><br></pre></td></tr></table></figure>

<p>In this example we can see the primitive type (integer) behaves differently comparing to String. There are several reason:</p>
<ul>
<li>primitive variables are stored in the stack(cheap), while other types are stored in the heap(expansive).</li>
<li>Primitive variables implemented ‘copy’ trait, ‘y&#x3D;x’ actually creates a copy of ‘x’ and assigns it to ‘y’</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">str_literal</span>=<span class="string">&quot;abc&quot;</span>; <span class="comment">// &amp;str, stored distinctly from heap and stack</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>=<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>); <span class="comment">//String</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1_ref</span>=&amp;s1; <span class="comment">//&amp;String</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>=s1.<span class="title function_ invoke__">clone</span>() <span class="comment">//String, a separated instance in memory</span></span><br></pre></td></tr></table></figure>

<h2 id="4-mut"><a href="#4-mut" class="headerlink" title="4. mut"></a>4. <code>mut</code></h2><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">5</span>;</span><br><span class="line"><span class="comment">//a=6; This is Not allowed since a is immutable</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">b</span>=<span class="number">10</span>;</span><br><span class="line">b=<span class="number">11</span>; <span class="comment">//This is fine</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span>= &amp;<span class="keyword">mut</span> b;</span><br><span class="line"><span class="comment">//c=12; This is Not allowed, because c is immutable</span></span><br><span class="line"><span class="comment">//b=12; This is Not allowed because a value can only have one mutable reference which is &#x27;c&#x27;</span></span><br><span class="line">*c=<span class="number">12</span>; <span class="comment">//This is fine</span></span><br><span class="line"><span class="comment">//println!(&quot;value of b is &#123;&#125;&quot;, b);  Not allowed because b is borrowed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">d</span> = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">e</span> = <span class="number">30</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;d is &#123;&#125;, e is &#123;&#125;&quot;</span>, d, e); <span class="comment">// d is 20, e is 30</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = &amp;<span class="keyword">mut</span> d; <span class="comment">// f is a mutable reference to the mutable reference of d;</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//20</span></span><br><span class="line">*f = <span class="number">21</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//21</span></span><br><span class="line"><span class="comment">//println!(&quot;d is &#123;&#125;, f is &#123;&#125;&quot;, d, f); this is not allowed, f holds the exclusive reference of d, d is temporarily invalid</span></span><br><span class="line">f = &amp;<span class="keyword">mut</span> e;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//30</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;d is &#123;&#125;, f is &#123;&#125;&quot;</span>, d, f); <span class="comment">// This is fine because f released the reference to d.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Meaning-of-mut"><a href="#Meaning-of-mut" class="headerlink" title="Meaning of mut"></a>Meaning of <code>mut</code></h3><ul>
<li>The declared variable can be modified<ul>
<li><pre><code class="rust">  lex mut x=5;
  x=6;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- ```rust</span><br><span class="line">    let mut a = String::form(&quot;abc&quot;);</span><br><span class="line">    a = String::form(&quot;efg&quot;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><code>&amp;mut</code> creats a mutable reference of a value. For example <code>let mut a = &amp;mut b;</code> meaning:<ul>
<li><code>a</code> would hold the exclusive access to b until <code>a</code> is out of scope.</li>
<li>The ownership of <code>b</code> will not changed, when <code>a</code> is no longer valid, the exclusive access will return to <code>b</code></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0301-types/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0301-types/" itemprop="url">Rust lesson 3.1 - Data Types</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T20:14:34+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Getting-familiar-with-Data-types"><a href="#Target-Getting-familiar-with-Data-types" class="headerlink" title="Target: Getting familiar with Data types"></a>Target: Getting familiar with Data types</h1><h2 id="1-Scalar-Types"><a href="#1-Scalar-Types" class="headerlink" title="1. Scalar Types"></a>1. Scalar Types</h2><h3 id="1-1-Integer"><a href="#1-1-Integer" class="headerlink" title="1.1 Integer"></a>1.1 Integer</h3><h4 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h4><ul>
<li>i: signed</li>
<li>u: unsigned</li>
</ul>
<table>
<thead>
<tr>
<th>Length</th>
<th>Signed</th>
<th>Unsigned</th>
</tr>
</thead>
<tbody><tr>
<td><strong>8-bit</strong></td>
<td>i8</td>
<td>u8</td>
</tr>
<tr>
<td><strong>16-bit</strong></td>
<td>i16</td>
<td>u16</td>
</tr>
<tr>
<td><strong>32-bit</strong></td>
<td>i32</td>
<td>u32</td>
</tr>
<tr>
<td><strong>64-bit</strong></td>
<td>i64</td>
<td>u64</td>
</tr>
<tr>
<td><strong>128-bit</strong></td>
<td>i128</td>
<td>u128</td>
</tr>
<tr>
<td><strong>arch</strong></td>
<td>isize</td>
<td>usize</td>
</tr>
</tbody></table>
<h4 id="Integer-Literals"><a href="#Integer-Literals" class="headerlink" title="Integer Literals"></a>Integer Literals</h4><table>
<thead>
<tr>
<th>Number literals</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>Decimal</td>
<td>98_222</td>
</tr>
<tr>
<td>Hex</td>
<td>0xff</td>
</tr>
<tr>
<td>Octal</td>
<td>0o77</td>
</tr>
<tr>
<td>Binary</td>
<td>0b1111_0000</td>
</tr>
<tr>
<td>Byte (u8 only)</td>
<td>b’A’</td>
</tr>
</tbody></table>
<h3 id="1-2-Floating-Point"><a href="#1-2-Floating-Point" class="headerlink" title="1.2 Floating-Point"></a>1.2 Floating-Point</h3><p><code>f32, f64</code></p>
<p><strong>These will lose precision in the arithmetic, using integer instead</strong></p>
<h3 id="1-3-Boolean"><a href="#1-3-Boolean" class="headerlink" title="1.3 Boolean"></a>1.3 Boolean</h3><p>true&#x2F;false</p>
<h3 id="1-4-Character"><a href="#1-4-Character" class="headerlink" title="1.4 Character"></a>1.4 Character</h3><p>In rust, char can store any valid Unicaode(up to 4bytes).</p>
<p><code>&quot;a 你好&quot;</code></p>
<ul>
<li>‘a’: 1 byte (0x61)</li>
<li>‘你’: 3 bytes (0xe4 0xbd 0xa0)</li>
<li>‘好’: 3 bytes (0xe5 a5 bd)</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">text</span> = <span class="string">&quot;a你好&quot;</span>;</span><br><span class="line"><span class="comment">// Byte length of the string</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Byte length: &#123;&#125;&quot;</span>, text.<span class="title function_ invoke__">len</span>()); <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Character length of the string</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Character length: &#123;&#125;&quot;</span>, text.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">count</span>()); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Loop through every character</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> text.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;Character: &#123;&#125;&quot;</span>, c); <span class="comment">//a你好</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">ni</span> = text.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">nth</span>(<span class="number">1</span>); <span class="comment">//Some(你)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">char_a</span>=text[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//text[1]: this will NOT work, becease 你 is a slice from 1 to 3(text[1..4]), and spliting is not allowed</span></span><br></pre></td></tr></table></figure>

<h2 id="2-Compound-Types"><a href="#2-Compound-Types" class="headerlink" title="2. Compound Types"></a>2. Compound Types</h2><h3 id="2-1-Arrays"><a href="#2-1-Arrays" class="headerlink" title="2.1 Arrays"></a>2.1 Arrays</h3><ul>
<li>fixed length</li>
<li>same type</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]; <span class="comment">//</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = [<span class="number">3</span>; <span class="number">5</span>]; <span class="comment">//[3, 3, 3, 3, 3];</span></span><br><span class="line"><span class="comment">//to loop over the array</span></span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> a.iter&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span>  <span class="keyword">in</span> &amp;a &#123;&#125;</span><br><span class="line"><span class="comment">//to access the value by its index</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;The first element in the array b is &#123;&#125;&quot;</span>, b[<span class="number">0</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Structs"><a href="#2-2-Structs" class="headerlink" title="2.2 Structs"></a>2.2 Structs</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//regular</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//tuple struct</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"><span class="comment">//unit</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/24/rust-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/24/rust-02/" itemprop="url">Rust lesson 2 - Rust basics</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-24T20:02:54+08:00">
                2024-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Getting-familiar-with-basics"><a href="#Target-Getting-familiar-with-basics" class="headerlink" title="Target: Getting familiar with basics"></a>Target: Getting familiar with basics</h1><h2 id="1-Variables-and-Mutability"><a href="#1-Variables-and-Mutability" class="headerlink" title="1. Variables and Mutability"></a>1. Variables and Mutability</h2><h3 id="1-1-Variables"><a href="#1-1-Variables" class="headerlink" title="1.1 Variables"></a>1.1 Variables</h3><p>To define a variable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let x=5;</span><br><span class="line">//x=6 would throw an error</span><br></pre></td></tr></table></figure>

<p>By default, the ‘x’ is immutabel, to make a variable mutable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut x=5;</span><br><span class="line">x=6;</span><br></pre></td></tr></table></figure>

<h4 id="Shadowing"><a href="#Shadowing" class="headerlink" title="Shadowing"></a>Shadowing</h4><p>Declaring a new variable with the same name as a previous variable, this is true for both mutable and immutable variables.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>; <span class="comment">//6</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = x * <span class="number">2</span>; <span class="comment">// 12</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value of x in the inner scope is: &#123;x&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>); <span class="comment">//6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The shadowing variable can be defined as the different data type:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let spaces = &quot;   &quot;;</span><br><span class="line">let spaces = spaces.len();</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Constant"><a href="#1-2-Constant" class="headerlink" title="1.2 Constant"></a>1.2 Constant</h3><p>To define a constant:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;</span><br></pre></td></tr></table></figure>

<p>Comparing to variables, the constant:</p>
<ul>
<li>is always immutable</li>
<li>annote the type explicitly</li>
<li>naming in uppercase fashion</li>
<li>value must be defined in the declaration</li>
<li>can not be shadowed</li>
</ul>
<h3 id="1-3-Static"><a href="#1-3-Static" class="headerlink" title="1.3 Static"></a>1.3 Static</h3><p>To define a static:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;</span><br></pre></td></tr></table></figure>

<p>Comparing to constant, the static:</p>
<ul>
<li>can be mutable with ‘mut’ keyword, but this is NOT SAFE (surrounded in a ‘unsafe’ block).</li>
<li>in the runtime, the constant is the acutual value compiler would replace it in the compilation. while static is alway pointing to the address.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
