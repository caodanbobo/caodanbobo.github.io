<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/3/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/23/rust-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/23/rust-01/" itemprop="url">Rust lesson 1 - Hello World!</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-23T20:12:52+08:00">
                2024-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Setting-up-Rust-development-environment"><a href="#Target-Setting-up-Rust-development-environment" class="headerlink" title="Target: Setting up Rust development environment"></a>Target: Setting up Rust development environment</h1><h2 id="1-Installation"><a href="#1-Installation" class="headerlink" title="1. Installation"></a>1. Installation</h2><p>Installing rustup in terminal:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 https://sh.rustup.rs -sSf | sh</span><br></pre></td></tr></table></figure>

<p>To check whether your installion successed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rustc --version</span><br></pre></td></tr></table></figure>

<h2 id="2-Setting-up-IDE-VS-Code"><a href="#2-Setting-up-IDE-VS-Code" class="headerlink" title="2. Setting up IDE (VS Code)"></a>2. Setting up IDE (VS Code)</h2><p>If you are going to code rust with vs code, here are some usfer plugins:</p>
<ol>
<li>rust-analyzer</li>
<li>Even Better TOML</li>
<li>Dependi (a modern <code>cartes</code>)</li>
</ol>
<h2 id="3-Hello-World"><a href="#3-Hello-World" class="headerlink" title="3. Hello World"></a>3. Hello World</h2><p>To run our frist rust functio, we can simply create a ‘.rs’ file, e.g., ‘main.rs’:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then building it with command <code>rustc main.rs</code>, there would be a binary file ‘main’. And the file can be executed in your terminal or other command line tools.</p>
<h2 id="4-Cargo"><a href="#4-Cargo" class="headerlink" title="4. Cargo"></a>4. Cargo</h2><p>Cargo is Rust’s build system and package manager. It is a great tool helping developers building the codes and managing the dependices.</p>
<ol>
<li>Creating a Project with Cargo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new hello_cargo</span><br></pre></td></tr></table></figure></li>
<li>Build the project<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br></pre></td></tr></table></figure>
This command creates an executable file in target&#x2F;debug&#x2F;hello_cargo, similar to building with ‘rustc’.</li>
<li>Build and Run<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run</span><br></pre></td></tr></table></figure></li>
<li>Just compile without producing an executable<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo check</span><br></pre></td></tr></table></figure></li>
<li>Building for Release<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build --release</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="5-Dependencies-management-with-cargo"><a href="#5-Dependencies-management-with-cargo" class="headerlink" title="5. Dependencies management with cargo"></a>5. Dependencies management with cargo</h2><p>Dependencis of the project are listed in the ‘Cargo.toml’ file, for example:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello_cargo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">rand</span>=<span class="string">&quot;0.8.5&quot;</span></span><br></pre></td></tr></table></figure>

<p>In this example, a ‘rand’ library is added.</p>
<h3 id="The-remote-repository-of-Cargo-dependencis-optional"><a href="#The-remote-repository-of-Cargo-dependencis-optional" class="headerlink" title="The remote repository of Cargo dependencis[optional]"></a>The remote repository of Cargo dependencis[optional]</h3><p>Sometimes, we want to change the remote repository for fatser downloading, the default source can be override by adding follow configuration in ‘$HOME&#x2F;.cargo&#x2F;config.toml’:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[source.crates-io]</span></span><br><span class="line"><span class="attr">replace-with</span> = <span class="string">&#x27;ustc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[source.ustc]</span></span><br><span class="line"><span class="attr">registry</span> = <span class="string">&quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/16/Solidity-lesson4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/16/Solidity-lesson4/" itemprop="url">Solidity Lesson 4 - Upgradeable Smart Contracts</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-16T21:38:26+08:00">
                2024-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Understanding-Upgradeable-Smart-Contracts"><a href="#Target-Understanding-Upgradeable-Smart-Contracts" class="headerlink" title="Target: Understanding Upgradeable Smart Contracts"></a>Target: Understanding Upgradeable Smart Contracts</h1><h2 id="1-Key-concepts"><a href="#1-Key-concepts" class="headerlink" title="1. Key concepts"></a>1. Key concepts</h2><h3 id="1-1-Fallback-function"><a href="#1-1-Fallback-function" class="headerlink" title="1.1 Fallback function"></a>1.1 Fallback function</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fallback() external payable&#123;&#125;</span><br><span class="line">receieve() external payable&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>fallback</strong> is a special function that is executed either when</p>
<ul>
<li>a function that does not exist is called or</li>
<li>Ether is sent directly to a contract but receive() does not exist or msg.data is not empty</li>
</ul>
<h3 id="1-2-Delegatecall-function"><a href="#1-2-Delegatecall-function" class="headerlink" title="1.2 Delegatecall function"></a>1.2 Delegatecall function</h3><p><strong>delegatecall</strong> is a low level function similar to <code>call</code>.<br>When contract A executes delegatecall to contract B, B’s code is executed with contract A’s storage, <code>msg.sender</code> and <code>msg.value</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">// NOTE: Deploy this contract first</span><br><span class="line">contract B &#123;</span><br><span class="line">    // NOTE: storage layout must be the same as contract A</span><br><span class="line">    uint256 public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setVars(uint256 _num) public payable &#123;</span><br><span class="line">        num = _num;</span><br><span class="line">        sender = msg.sender;</span><br><span class="line">        value = msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    uint256 public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setVars(address _contract, uint256 _num) public payable &#123;</span><br><span class="line">        // A&#x27;s storage is set, B is not modified.</span><br><span class="line">        (bool success, bytes memory data) = _contract.delegatecall(</span><br><span class="line">            abi.encodeWithSignature(&quot;setVars(uint256)&quot;, _num)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-Storage"><a href="#1-3-Storage" class="headerlink" title="1.3 Storage"></a>1.3 Storage</h3><ul>
<li>Storage Slot Assignment: In Solidity, state variables are assigned to storage slots in the order they are declared:<ul>
<li>The first declared variable is stored in slot 0.</li>
<li>The second in slot 1, and so on.</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract MyImplementation &#123;</span><br><span class="line">    uint256 public value;  // Stored in slot 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Proxy Contract Storage: Even though the proxy contract doesn’t explicitly declare a value variable, its storage layout is still accessible to the implementation contract when delegatecall is used.<br>When delegatecall is invoked:</li>
<li>The value variable in MyImplementation refers to storage slot 0.</li>
<li>This slot 0 is located in the proxy contract’s storage.<br>Thus, when MyImplementation’s setValue function is called through the proxy:</li>
<li>The value in slot 0 of the proxy’s storage is updated.</li>
</ul>
<h2 id="2-The-idea-of-Upgradeable-contracts"><a href="#2-The-idea-of-Upgradeable-contracts" class="headerlink" title="2. The idea of Upgradeable contracts"></a>2. The idea of Upgradeable contracts</h2><p>Now, we have learnt the basics, the idea of upgradeable contracts is based on this:</p>
<ol>
<li>Undefined function calls to the proxy contract can be handled by the fallback function which will make a <code>delegatecall</code> to respective implementation contracts.</li>
<li><code>delegatecall</code> would only modify the proxy contract’s state variables, as long as those variables’ slot position and type are identical to implememtation contracts’, everything will works fine.</li>
</ol>
<h2 id="3-Patterns-of-Upgradeable-contracts"><a href="#3-Patterns-of-Upgradeable-contracts" class="headerlink" title="3. Patterns of Upgradeable contracts"></a>3. Patterns of Upgradeable contracts</h2><h3 id="3-1-Transparent-Proxy"><a href="#3-1-Transparent-Proxy" class="headerlink" title="3.1 Transparent Proxy"></a>3.1 Transparent Proxy</h3><p>Separates admin and user roles clearly, with the proxy itself handling upgrades and admin functions.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract Implementation &#123;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setValue(uint256 _value) external &#123;</span><br><span class="line">        value = _value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract TransparentProxy &#123;</span><br><span class="line">    address private _implementation;</span><br><span class="line">    address private _admin;</span><br><span class="line"></span><br><span class="line">    constructor(address implementation_, address admin_) &#123;</span><br><span class="line">        _implementation = implementation_;</span><br><span class="line">        _admin = admin_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyAdmin() &#123;</span><br><span class="line">        require(msg.sender == _admin, &quot;Not admin&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function upgradeTo(address newImplementation) external onlyAdmin &#123;</span><br><span class="line">        _implementation = newImplementation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _delegate(address implementation) internal &#123;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            // Copy the call data.</span><br><span class="line">            calldatacopy(0, 0, calldatasize())</span><br><span class="line"></span><br><span class="line">            // Delegate the call to the implementation.</span><br><span class="line">            let result := delegatecall(gas(), implementation, 0, calldatasize(), 0, 0)</span><br><span class="line"></span><br><span class="line">            // Copy the returned data.</span><br><span class="line">            returndatacopy(0, 0, returndatasize())</span><br><span class="line"></span><br><span class="line">            // Return the result of the call.</span><br><span class="line">            switch result</span><br><span class="line">            case 0 &#123; revert(0, returndatasize()) &#125;</span><br><span class="line">            default &#123; return(0, returndatasize()) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        if (msg.sender == _admin) &#123;</span><br><span class="line">            // If the caller is the admin, do nothing.</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // Otherwise, delegate the call to the implementation.</span><br><span class="line">        _delegate(_implementation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;</span><br><span class="line">        // Allow the contract to receive ETH.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract ProxyAdmin &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;Not owner&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function changeProxyAdmin(TransparentProxy proxy, address newAdmin) external onlyOwner &#123;</span><br><span class="line">        proxy.upgradeTo(newAdmin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function upgrade(TransparentProxy proxy, address newImplementation) external onlyOwner &#123;</span><br><span class="line">        proxy.upgradeTo(newImplementation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, ProxyAdmin is used to control the proxy, and it is not necessary, especially for a single proxy scenario. The ProxyAdmin contract is an additional layer used to manage the proxy contract</p>
<h3 id="3-2-UUPS-Universal-Upgradeable-Proxy-Standard"><a href="#3-2-UUPS-Universal-Upgradeable-Proxy-Standard" class="headerlink" title="3.2 UUPS(Universal Upgradeable Proxy Standard)"></a>3.2 UUPS(Universal Upgradeable Proxy Standard)</h3><p>Places more responsibility on the implementation contract for managing upgrades, offering more flexibility but requiring careful management.</p>
<h3 id="3-3-Diamond-EIP-2535"><a href="#3-3-Diamond-EIP-2535" class="headerlink" title="3.3 Diamond(EIP-2535)"></a>3.3 Diamond(EIP-2535)</h3><p>Allowing for more complex upgradeable contracts, specifically those with multiple facets, each containing different functions. This pattern is highly flexible and allows contracts to scale without becoming monolithic.</p>
<hr>
<h3 id="Comparison-Table"><a href="#Comparison-Table" class="headerlink" title="Comparison Table:"></a>Comparison Table:</h3><table>
<thead>
<tr>
<th>Feature</th>
<th>Transparent Proxy</th>
<th>UUPS</th>
<th>Diamond (EIP-2535)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Upgrade Control</strong></td>
<td>Separate <code>ProxyAdmin</code> contract</td>
<td>Managed by implementation</td>
<td>Managed by facets</td>
</tr>
<tr>
<td><strong>Gas Efficiency</strong></td>
<td>More expensive (extra contract)</td>
<td>More gas-efficient</td>
<td>Potentially higher due to complexity</td>
</tr>
<tr>
<td><strong>Modularity</strong></td>
<td>Limited</td>
<td>Limited</td>
<td>Highly modular</td>
</tr>
<tr>
<td><strong>Admin Management</strong></td>
<td>Proxy admin vs user roles</td>
<td>Admin is in charge of upgrades</td>
<td>More complex admin control</td>
</tr>
<tr>
<td><strong>Upgradeability Granularity</strong></td>
<td>Entire implementation contract</td>
<td>Entire implementation contract</td>
<td>Upgrade individual facets</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Medium</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td><strong>Best Use Case</strong></td>
<td>DeFi, stable projects</td>
<td>Small apps or simple systems</td>
<td>Large modular platforms</td>
</tr>
</tbody></table>
<h3 id="Choosing-Between-Transparent-Proxy-UUPS-and-Diamond"><a href="#Choosing-Between-Transparent-Proxy-UUPS-and-Diamond" class="headerlink" title="Choosing Between Transparent Proxy, UUPS, and Diamond"></a>Choosing Between Transparent Proxy, UUPS, and Diamond</h3><ol>
<li><p><strong>Transparent Proxy</strong>:</p>
<ul>
<li>Best for established systems that need clear separation between users and admin.</li>
<li>Most widely used, considered more secure and tested, but a bit more complex.</li>
<li>Suitable for DeFi protocols or projects with high stakes and security needs.</li>
</ul>
</li>
<li><p><strong>UUPS</strong>:</p>
<ul>
<li>Ideal for lightweight contracts or simpler systems where ease of use and efficiency is more important.</li>
<li>You still have upgradeability without the overhead of managing a separate <code>ProxyAdmin</code> contract.</li>
</ul>
</li>
<li><p><strong>Diamond (EIP-2535)</strong>:</p>
<ul>
<li>Perfect for complex, modular systems that need to scale. If you’re building a platform that will continuously evolve with new features, Diamond’s facet-based architecture offers significant flexibility.</li>
<li>Adds complexity but provides long-term benefits in terms of modular upgrades.</li>
</ul>
</li>
</ol>
<p>Each upgrade pattern has its strengths, and the best choice depends on the complexity, gas efficiency, and upgrade requirements of your project.</p>
<h2 id="3-One-more-thing-about-Storage-slot"><a href="#3-One-more-thing-about-Storage-slot" class="headerlink" title="3. One more thing about Storage slot"></a>3. One more thing about Storage slot</h2><h3 id="Modular-storage"><a href="#Modular-storage" class="headerlink" title="Modular storage"></a>Modular storage</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">struct AppStorage &#123;</span><br><span class="line">    uint256 a;</span><br><span class="line">    uint8 b;</span><br><span class="line">    uint8 c;</span><br><span class="line">    uint8 d;</span><br><span class="line">    address contractA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">library Storage &#123;</span><br><span class="line">    bytes32 constant KEY = keccak256(&quot;storage-local&quot;);</span><br><span class="line"></span><br><span class="line">    function get() internal pure returns (AppStorage storage s) &#123;</span><br><span class="line">        bytes32 loc = KEY;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            s.slot := loc</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This allows the storage layout to be shared across different facets or functions, avoiding conflicts between different components.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/16/Solidity-lesson3.3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/16/Solidity-lesson3.3/" itemprop="url">Solidity Lesson 3.3 - Randomness</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-16T14:51:33+08:00">
                2024-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Blockchain-Ethereum-Randomness-101"><a href="#Target-Blockchain-Ethereum-Randomness-101" class="headerlink" title="Target: Blockchain(Ethereum) Randomness 101"></a>Target: Blockchain(Ethereum) Randomness 101</h1><h2 id="1-Code-Example"><a href="#1-Code-Example" class="headerlink" title="1. Code Example"></a>1. Code Example</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">contract Hero &#123;</span><br><span class="line">    enum HeroType &#123;</span><br><span class="line">        Mege,</span><br><span class="line">        Healer,</span><br><span class="line">        Barbarian</span><br><span class="line">    &#125;</span><br><span class="line">    mapping(address =&gt; uint256[]) private addressToHeroType;</span><br><span class="line"></span><br><span class="line">    function getHeros() public view returns (uint256[] memory) &#123;</span><br><span class="line">        return addressToHeroType[msg.sender];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createHero(HeroType _type) public payable &#123;</span><br><span class="line">        require(msg.value &gt;= 0.5 ether, &quot;please send at least 0.5 eth&quot;);</span><br><span class="line"></span><br><span class="line">        uint256[] memory stats = new uint[](5);</span><br><span class="line">        stats[0] = 2;</span><br><span class="line">        stats[1] = 7;</span><br><span class="line">        stats[2] = 12;</span><br><span class="line">        stats[3] = 17;</span><br><span class="line">        stats[4] = 22;</span><br><span class="line"></span><br><span class="line">        uint256 len = 5;</span><br><span class="line">        uint h = uint256(_type);</span><br><span class="line"></span><br><span class="line">        do &#123;</span><br><span class="line">            uint256 pos = generateRandom() % len;</span><br><span class="line">            uint256 value = (generateRandom() % (13 + len)) + 1;</span><br><span class="line">            h |= value &lt;&lt; stats[pos];</span><br><span class="line">            len--;</span><br><span class="line">            stats[pos] = stats[len];</span><br><span class="line">        &#125; while (len &gt; 0);</span><br><span class="line"></span><br><span class="line">        addressToHeroType[msg.sender].push(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function generateRandom() public view returns (uint256) &#123;</span><br><span class="line">        return</span><br><span class="line">            uint256(</span><br><span class="line">                keccak256(</span><br><span class="line">                    abi.encodePacked(</span><br><span class="line">                        block.prevrandao,</span><br><span class="line">                        block.timestamp,</span><br><span class="line">                        msg.sender</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-Why-the-generateRandom-is-insecure"><a href="#1-Why-the-generateRandom-is-insecure" class="headerlink" title="1. Why the generateRandom() is insecure"></a>1. Why the <code>generateRandom()</code> is insecure</h3><p><strong>Randomness via On-Chain Data (e.g., block.timestamp, block.prevrandao)</strong></p>
<pre><code>Using data like block.timestamp, block.prevrandao, and msg.sender is a common approach for generating “random” numbers in smart contracts. The idea is to take some data that varies from block to block and hash it (usually with keccak256), which gives a result that looks random but is predictable for someone who knows all the inputs.
</code></pre>
<h3 id="2-Other-issues"><a href="#2-Other-issues" class="headerlink" title="2. Other issues"></a>2. Other issues</h3><ul>
<li>shall we store the ‘stats’ other places to save gas?<ul>
<li><strong>in ‘storage’</strong>? NO! Reading from and writing to storage is much more expensive than working with memory. Storing a small, fixed-size array in storage may increase gas costs rather than reduce them.</li>
<li><strong>specifing it as ‘constant’?</strong> it is a good idea, however, only primitive time and fixed-sized byte array can be specified as ‘constant’</li>
<li><strong>specifing it as ‘immutable’?</strong> similar to ‘constant’, array can not specified as ‘immutable’.</li>
</ul>
</li>
<li><code>stats[pos] = stats[len];</code><br>This is very similar to the swap in the quicksort</li>
</ul>
<h2 id="2-Chainlink-VRF-2-5"><a href="#2-Chainlink-VRF-2-5" class="headerlink" title="2. Chainlink VRF 2.5"></a>2. Chainlink VRF 2.5</h2><h3 id="True-randomness-can-only-be-generated-off-chain"><a href="#True-randomness-can-only-be-generated-off-chain" class="headerlink" title="True randomness can only be generated off-chain"></a>True randomness can only be generated off-chain</h3><p><strong>Deterministic nature of blockchain</strong>: The Ethereum blockchain, like most blockchains, operates in a deterministic manner. This means that every operation performed on the blockchain must produce the same result for all nodes in the network. This determinism is essential to ensure consensus among all nodes, allowing them to agree on the state of the blockchain.</p>
<ul>
<li>Consensus: All nodes in the Ethereum network must be able to independently verify transactions and blocks to reach consensus.</li>
<li>Security: Determinism ensures that the outcome of a transaction is predictable and verifiable by anyone running an Ethereum node.</li>
</ul>
<h3 id="How-to-use-chainlink-VRF"><a href="#How-to-use-chainlink-VRF" class="headerlink" title="How to use chainlink VRF"></a>How to use chainlink VRF</h3><p><a target="_blank" rel="noopener" href="https://docs.chain.link/vrf/v2-5/subscription/get-a-random-number">Chainlink VRF2.5</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/15/Solidity-lesson3.2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/15/Solidity-lesson3.2/" itemprop="url">Solidity Lesson 3.2 - Connecting to Metamask II</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-15T10:41:34+08:00">
                2024-09-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Learn-how-to-send-transactions-write-to-chain"><a href="#Target-Learn-how-to-send-transactions-write-to-chain" class="headerlink" title="Target: Learn how to send transactions (write to chain)"></a>Target: Learn how to send transactions (write to chain)</h1><h2 id="1-Issues-I-encountered"><a href="#1-Issues-I-encountered" class="headerlink" title="1. Issues I encountered"></a>1. Issues I encountered</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//prompt for permission if no connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">BrowserProvider</span>(<span class="title function_">getEth</span>());</span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;function getCount() public view returns (uint256)&quot;</span>,</span><br><span class="line">      <span class="string">&quot;function count() public&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="keyword">await</span> provider.<span class="title function_">getSigner</span>() <span class="comment">//provider or signer</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//debug</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(contract);</span><br><span class="line">  <span class="comment">//interaction with contract</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    counter.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">incremnet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">await</span> contract.<span class="title function_">count</span>();</span><br><span class="line">    <span class="keyword">await</span> tx.<span class="title function_">wait</span>();</span><br><span class="line">    <span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setup html</span></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.<span class="property">innerHTML</span> = <span class="string">&quot;increment&quot;</span>;</span><br><span class="line"></span><br><span class="line">  btn.<span class="property">onclick</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">incremnet</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(counter);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn);</span><br><span class="line">  <span class="comment">//display count when page refreshing</span></span><br><span class="line">  <span class="title function_">getCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>contract.count is not a function</code></p>
<p>Cause: a redundant white space when copying the function signature to the abi part.</p>
</li>
<li><p><code>Nonce too high. Expected nonce to be 2 but got 9. Note that transactions can&#39;t be queued when automining.</code></p>
<p>Cause: Metamask cache, by clearing it will fix this.</p>
</li>
</ul>
<h2 id="2-Event-listener"><a href="#2-Event-listener" class="headerlink" title="2. Event listener"></a>2. Event listener</h2><p>Contract:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">contract Counter &#123;</span><br><span class="line">    event countIncremented(address indexed user, uint256 count);</span><br><span class="line"></span><br><span class="line">    uint256 private s_counter;</span><br><span class="line"></span><br><span class="line">    function count() public &#123;</span><br><span class="line">        s_counter++;</span><br><span class="line">        emit countIncremented(msg.sender, s_counter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getCount() public view returns (uint256) &#123;</span><br><span class="line">        return s_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; abi &#125; <span class="keyword">from</span> <span class="string">&quot;../artifacts/contracts/Counter.sol/Counter.json&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//prompt for permission if no connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">BrowserProvider</span>(<span class="title function_">getEth</span>()); <span class="comment">//ethers v6</span></span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    abi,</span><br><span class="line">    <span class="keyword">await</span> provider.<span class="title function_">getSigner</span>() <span class="comment">//provider or signer</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//debug</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(contract);</span><br><span class="line">  <span class="comment">//interaction with contract</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    counter.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">incremnet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> contract.<span class="title function_">count</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//&#x27;contract.on&#x27; &#x27;listeners</span></span><br><span class="line">  <span class="comment">//filtering all</span></span><br><span class="line">  contract.<span class="title function_">on</span>(<span class="string">&quot;countIncremented&quot;</span>, <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">    counter.<span class="property">innerHTML</span> = count.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//filtering certain sender</span></span><br><span class="line">  contract.<span class="title function_">on</span>(</span><br><span class="line">    contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">      <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">      counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//this won&#x27;t work since &#x27;count&#x27; is not indexed</span></span><br><span class="line">  contract.<span class="title function_">on</span>(</span><br><span class="line">    contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">      <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">      <span class="number">10</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">      counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setup html</span></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.<span class="property">innerHTML</span> = <span class="string">&quot;increment&quot;</span>;</span><br><span class="line"></span><br><span class="line">  btn.<span class="property">onclick</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">incremnet</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(counter);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn);</span><br><span class="line">  <span class="comment">//display count when page refreshing</span></span><br><span class="line">  <span class="title function_">getCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<h3 id="contract-on"><a href="#contract-on" class="headerlink" title="contract.on"></a><code>contract.on</code></h3><p>contract.on(“eventName”, callback) listens for the event emitted by the contract.</p>
<ol>
<li>filtering all</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract.<span class="title function_">on</span>(<span class="string">&quot;countIncremented&quot;</span>, <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">  counter.<span class="property">innerHTML</span> = count.<span class="title function_">toString</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>filtering indexed arguments</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract.<span class="title function_">on</span>(</span><br><span class="line">  contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">    <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">    <span class="literal">null</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">    counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>if there are no specific criteras to filter, <code>&quot;countIncremented&quot;</code> and <code>contract.filters.countIncremented()</code>both world work. but the arguments of callback function has to follow the order of event.</li>
<li>if there are indexed arguments to filter, all the arguments need to be listed in the filter, e.g., <code>contract.filters.countIncremented(&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;,null ),</code>.</li>
<li>non-indexed arguments CAN NOT be filtered, <code>contract.filters.countIncremented(null,10),</code> won’t work.</li>
<li>Different listeners for same event type might interfere with each other, only one of them will catch the event.</li>
</ul>
<h2 id="provider-on"><a href="#provider-on" class="headerlink" title="provider.on"></a><code>provider.on</code></h2><p>provider.on is more general and allows you to listen for any blockchain events, not just events emitted by a specific contract. It’s helpful for listening to logs, block events, or specific transaction events.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/15/webpack-101/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/15/webpack-101/" itemprop="url">Webpack Setup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-15T10:13:26+08:00">
                2024-09-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="target-Setting-up-webpack-to-do-basic-smart-contract-interaction"><a href="#target-Setting-up-webpack-to-do-basic-smart-contract-interaction" class="headerlink" title="target: Setting up webpack to do basic smart contract interaction"></a>target: Setting up webpack to do basic smart contract interaction</h1><h2 id="1-install-Webpack"><a href="#1-install-Webpack" class="headerlink" title="1. install Webpack"></a>1. install Webpack</h2><p>First, make sure you have Node.js and npm (or yarn) installed on your system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack webpack-cli typescript ts-loader html-webpack-plugin</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack: Bundles your files.</li>
<li>webpack-cli: Webpack’s command-line interface.</li>
<li>typescript: Adds TypeScript support.</li>
<li>ts-loader: Loads TypeScript files for Webpack.</li>
<li>html-webpack-plugin: Generates an index.html file automatically and injects the bundled JavaScript.</li>
</ul>
<h2 id="Create-the-project-structure"><a href="#Create-the-project-structure" class="headerlink" title="Create the project structure"></a>Create the project structure</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my-project/</span><br><span class="line">├── src/</span><br><span class="line">│   └── index.js  (your entry JavaScript/TypeScript file)</span><br><span class="line">├── dist/         (where the bundled output will go)</span><br><span class="line">├── package.json  (project metadata, scripts, and dependencies)</span><br><span class="line">└── webpack.config.js  (Webpack configuration file)</span><br></pre></td></tr></table></figure>

<p>(hardhat would do most of this for us)</p>
<h2 id="3-Create-webpack-config-js-and-tsconfig-json"><a href="#3-Create-webpack-config-js-and-tsconfig-json" class="headerlink" title="3. Create webpack.config.js and tsconfig.json"></a>3. Create webpack.config.js and tsconfig.json</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>, <span class="comment">// Entry point</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>, <span class="comment">// Output bundle</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>), <span class="comment">// Output directory</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// Clean the output directory before each build</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.js&quot;</span>], <span class="comment">// Resolve both .ts and .js files</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>, <span class="comment">// Use ts-loader for .ts files</span></span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="comment">// Use style-loader and css-loader for CSS files</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// Automatically inject the bundle into the HTML</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>, <span class="comment">// Use development mode for easier debugging</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-start-the-server"><a href="#4-start-the-server" class="headerlink" title="4. start the server"></a>4. start the server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn webpack serve</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/12/Solidity-lesson3.1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/12/Solidity-lesson3.1/" itemprop="url">Solidity Lesson 3.1 - Connecting to Metamask</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-12T20:45:37+08:00">
                2024-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Interact-with-deployed-contracts-using-Metamask"><a href="#Target-Interact-with-deployed-contracts-using-Metamask" class="headerlink" title="Target: Interact with deployed contracts using Metamask"></a>Target: Interact with deployed contracts using Metamask</h1><h2 id="1-Set-up-webpack"><a href="#1-Set-up-webpack" class="headerlink" title="1. Set up webpack"></a>1. Set up webpack</h2><ul>
<li><p>Create webpack.common.js under project root</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dotenv = <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>);</span><br><span class="line">dotenv.<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>, <span class="comment">// bundle&quot;s entry point</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>), <span class="comment">// output directory</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>, <span class="comment">// name of the generated bundle</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">inject</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Adding webpack dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D webpack webpack-cli ts-loader html-webpack-plugin dotenv webpack-dev-server</span><br></pre></td></tr></table></figure></li>
<li><p>tsconfig.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">        &quot;resolveJsonModule&quot;: true,</span><br><span class="line">        &quot;esModuleInterop&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-Interaction-using-Metamask"><a href="#2-Interaction-using-Metamask" class="headerlink" title="2. Interaction using Metamask"></a>2. Interaction using Metamask</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">AbstractProvider</span>(<span class="title function_">getEth</span>());</span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    [<span class="string">&quot;function hello() pure public returns (string memory)&quot;</span>],</span><br><span class="line">    provider</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">hello</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>getEth():<ul>
<li>window.ethereum is the provider injected by Ethereum wallets</li>
</ul>
</li>
<li>requestAccess()<ul>
<li><code>eth_requestAccounts</code> this command would prompt the user to grant permission for this website to access their Metamask acconts and return.</li>
<li>if the user has already granted permission, this will not trigger the prompt.</li>
</ul>
</li>
<li>hasSigners()<ul>
<li><code>eth_accounts</code> returns currently connected accounts.</li>
</ul>
</li>
<li><code>const contract = new ethers.Contract(address, abi, providerOrSigner);</code><ul>
<li>ethers.Contract() creates an instance of a deployed contract, allowing you to interact with it by calling its functions (read&#x2F;write) and listening for events.</li>
<li>Parameters:<ul>
<li>ABI: we are using human-readable ABI in the code above</li>
<li>Provider or Signer: Provider (for read-only operations) or a Signer (for sending transactions from a specific Ethereum account)</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/10/Solidity-lesson2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/10/Solidity-lesson2/" itemprop="url">Solidity Lesson 2 - Introduction of Testing and Deployment</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-10T22:07:32+08:00">
                2024-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Get-familiar-with-hardhat-testing-and-deployment"><a href="#Target-Get-familiar-with-hardhat-testing-and-deployment" class="headerlink" title="Target: Get familiar with hardhat testing and deployment"></a>Target: Get familiar with hardhat testing and deployment</h1><h2 id="1-Set-up-typescript"><a href="#1-Set-up-typescript" class="headerlink" title="1. Set up typescript"></a>1. Set up typescript</h2><p>We are going to use typescript for its popularity and readability in this whole course.</p>
<ul>
<li><p>Let’s install it first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D ts-node typescript</span><br></pre></td></tr></table></figure>
</li>
<li><p>Creating the typescript version of config file</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@nomicfoundation/hardhat-toolbox&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@nomicfoundation/hardhat-ethers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Config</span> = <span class="keyword">import</span>(<span class="string">&quot;hardhat/config&quot;</span>).<span class="property">HardhatUserConfig</span>;</span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> import(&#x27;hardhat/config&#x27;).HardhatUserConfig */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">config</span>: <span class="title class_">Config</span> = &#123;</span><br><span class="line">  <span class="attr">solidity</span>: <span class="string">&quot;0.8.24&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> config;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Finally, Adding a empty json file ‘tsconfig.json’ under project root, otherwise there will be an error during the typescript execution:</p>
<p><code>error TS5109: Option &#39;moduleResolution&#39; must be set to &#39;NodeNext&#39; (or left unspecified) when option &#39;module&#39; is set to &#39;NodeNext&#39;.</code></p>
</li>
</ul>
<h2 id="2-Testing"><a href="#2-Testing" class="headerlink" title="2. Testing"></a>2. Testing</h2><ol>
<li><p>Install ‘mocha’:<br><code>yarn add -D @types/mocha</code></p>
</li>
<li><p>create test file under ‘test’ folder</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@nomicfoundation/hardhat-ethers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;hardhat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">&quot;chai&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;HelloWorld&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should say hello&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="keyword">await</span> ethers.<span class="title function_">getContractFactory</span>(<span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> helloWorld = <span class="keyword">await</span> <span class="title class_">HelloWorld</span>.<span class="title function_">deploy</span>();</span><br><span class="line">    <span class="keyword">await</span> helloWorld.<span class="title function_">waitForDeployment</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(<span class="keyword">await</span> helloWorld.<span class="title function_">hello</span>()).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ethers.getContractFactory(&quot;HelloWorld&quot;)</code>: This retrieves a “contract factory” for the HelloWorld contract. A contract factory is an abstraction that makes it easier to deploy new instances of the contract.</li>
<li><code>HelloWorld.deploy()</code>: Deploys the contract to the blockchain.</li>
<li><code>await helloWorld.waitForDeployment()</code>: Waits until the deployment transaction is confirmed.</li>
</ul>
</li>
<li><p>run the test</p>
<p><code> yarn hart test</code></p>
</li>
</ol>
<h2 id="3-Deployment"><a href="#3-Deployment" class="headerlink" title="3. Deployment"></a>3. Deployment</h2><ol>
<li><p>create deployment script under ‘scripts’ folder</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@nomicfoundation/hardhat-ethers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;hardhat&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">deploy</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="keyword">await</span> ethers.<span class="title function_">getContractFactory</span>(<span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> helloWorld = <span class="keyword">await</span> <span class="title class_">HelloWorld</span>.<span class="title function_">deploy</span>();</span><br><span class="line">  <span class="keyword">await</span> helloWorld.<span class="title function_">waitForDeployment</span>();</span><br><span class="line">  <span class="keyword">return</span> helloWorld;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sayHello</span>(<span class="params"><span class="attr">hello</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> hello.<span class="title function_">hello</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">deploy</span>().<span class="title function_">then</span>(sayHello);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ethers.getContractFactory(&quot;HelloWorld&quot;)</code>:<ul>
<li>This retrieves a ContractFactory object for the HelloWorld contract, which is a wrapper around the compiled contract. A ContractFactory is an abstraction used to deploy new smart contracts.</li>
<li>The “HelloWorld” string references the contract by its name. Hardhat uses the contract’s ABI (Application Binary Interface) and bytecode (compiled form) to create this factory.</li>
</ul>
</li>
<li><code>HelloWorld.deploy()</code>:<ul>
<li>This function call initiates the deployment of the HelloWorld contract onto the blockchain. It broadcasts a transaction to the Ethereum network (or a local development network in the case of Hardhat), which contains the bytecode of the smart contract.</li>
<li>Once the contract is deployed, you get an instance of the contract (helloWorld), which represents the deployed contract on-chain(included in the mem-pool).</li>
</ul>
</li>
<li><code>await helloWorld.waitForDeployment();</code>:<ul>
<li>This waits for the contract deployment transaction to be mined and included in a block. After that, the helloWorld object will be fully initialized and ready to interact with.</li>
</ul>
</li>
</ul>
</li>
<li><p>start a local EVM environment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn hardhat node</span><br></pre></td></tr></table></figure></li>
<li><p>execute the deployment script to publish contracts to the test net</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn hardhat run ./scripts/deploy-hello.ts --network localhost</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="4-Further-reading"><a href="#4-Further-reading" class="headerlink" title="4. Further reading"></a>4. Further reading</h2><ul>
<li><strong>Hardhat</strong>: The core development environment that runs your project, manages tasks, and handles things like contract compilation, running tests, and connecting to networks.</li>
<li><strong>@nomicfoundation&#x2F;hardhat-ethers</strong>: A plugin that enhances Hardhat by adding ethers.js functionalities, allowing you to interact with Ethereum in a simple, pre-configured way.</li>
<li><strong>ethers</strong>: A customized version of ethers that is tightly integrated with Hardhat, not directly from the original ethers.js library.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/10/hexo-deployment-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/10/hexo-deployment-issue/" itemprop="url">fixing 'Spawn failed' error when deploying hexo with 'hexo deploy' command</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-10T21:02:23+08:00">
                2024-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="The-Error"><a href="#The-Error" class="headerlink" title="The Error"></a>The Error</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">error: RPC failed; HTTP 400 curl 22 The requested URL returned error: 400</span><br><span class="line">send-pack: unexpected disconnect while reading sideband packet</span><br><span class="line">Writing objects: 100% (171/171), 1.22 MiB | 1.41 MiB/s, done.</span><br><span class="line">Total 171 (delta 23), reused 0 (delta 0), pack-reused 0</span><br><span class="line">fatal: the remote end hung up unexpectedly</span><br><span class="line">Everything up-to-date</span><br><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: Spawn failed</span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (/Users/cdbb/blog/node_modules/hexo-deployer-git/node_modules/hexo-util/lib/spawn.js:51:21)</span><br><span class="line">    at ChildProcess.emit (node:events:518:28)</span><br><span class="line">    at ChildProcess._handle.onexit (node:internal/child_process:294:12)</span><br></pre></td></tr></table></figure>

<h1 id="Fixing"><a href="#Fixing" class="headerlink" title="Fixing"></a>Fixing</h1><p>I first tried looking for fixes on the error ‘Spawn failed<br>at ChildProcess.<anonymous> (&#x2F;Users&#x2F;cdbb&#x2F;blog&#x2F;node_modules&#x2F;hexo-deployer-git&#x2F;node_modules&#x2F;hexo-util&#x2F;lib&#x2F;spawn.js:51:21)’ . But all i got was about deleting the ‘.deploy_git’ folder located in ‘cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;hexo&#x2F;hanyubolg&#x2F;‘, and i could find it.<br>Than i noticed the error ‘error: RPC failed; HTTP 400 curl 22 The requested URL returned error: 400’, and found the answer <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/62753648/rpc-failed-http-400-curl-22-the-requested-url-returned-error-400-bad-request">here</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config http.postBuffer 524288000</span><br></pre></td></tr></table></figure>

<p>and tried <code>hexo g -d</code>, everything went through.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/09/Solidity-lesson1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/09/Solidity-lesson1/" itemprop="url">Solidity Lesson 1 - Enviroment Setup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-09T22:21:46+08:00">
                2024-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Set-up-the-environment-and-build-the-first-Solidity-contract"><a href="#Target-Set-up-the-environment-and-build-the-first-Solidity-contract" class="headerlink" title="Target: Set up the environment and build the first Solidity contract"></a>Target: Set up the environment and build the first Solidity contract</h1><h2 id="1-Setup-Hardhat"><a href="#1-Setup-Hardhat" class="headerlink" title="1. Setup Hardhat"></a>1. Setup Hardhat</h2><ol>
<li>Initialize the project:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init -y</span><br></pre></td></tr></table></figure></li>
<li>Install Hardhat as a dev dependency:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hardhat</span><br></pre></td></tr></table></figure></li>
<li>Create a Hardhat project:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn hardhat</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-Project-Structure"><a href="#2-Project-Structure" class="headerlink" title="2. Project Structure"></a>2. Project Structure</h2><p><strong>‘contracts’ folder</strong></p>
<p>This folder holds the smart contracts (*.sol files).</p>
<p><strong>‘scripts’ folder</strong></p>
<p>Programmers can write and store deploy scripts here.</p>
<p><strong>‘ignition&#x2F;modules’ folder</strong></p>
<p>Default deployment script files provided by Hardhat.</p>
<p><strong>‘test’ folder</strong></p>
<p>This folder is used for writing test scripts for your smart contracts.</p>
<h2 id="3-Hello-World-Contract"><a href="#3-Hello-World-Contract" class="headerlink" title="3. Hello World Contract"></a>3. Hello World Contract</h2><p>Here is the basic “Hello World” contract in Solidity:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24; // Must match the config file (hardhat.config.js)</span><br><span class="line"></span><br><span class="line">contract HelloWorld &#123;</span><br><span class="line">    function hello() public pure returns (string memory) &#123;</span><br><span class="line">        return &quot;Hello, world!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Compile-the-Contract"><a href="#4-Compile-the-Contract" class="headerlink" title="4. Compile the Contract"></a>4. Compile the Contract</h2><p>To compile your Solidity contract, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn hardhat compile</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/09/first-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/09/first-post/" itemprop="url">Hello Web3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-09T21:10:32+08:00">
                2024-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="My-First-Post-is-right-here"><a href="#My-First-Post-is-right-here" class="headerlink" title="My First Post is right here"></a>My First Post is right here</h1><blockquote>
<p>That’s one small step for man, one giant leap for web3</p>
</blockquote>
<p>Just kidding. Enjoy coding ^^.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
