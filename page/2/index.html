<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/2/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0303-functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0303-functions/" itemprop="url">Rust lesson 3.3 - Functions</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T21:45:53+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Functions-and-Methods"><a href="#Functions-and-Methods" class="headerlink" title="Functions and Methods"></a>Functions and Methods</h1><h2 id="1-Functions"><a href="#1-Functions" class="headerlink" title="1. Functions"></a>1. Functions</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fn</code> keyword</li>
<li>function name: plus_one</li>
<li><code>x</code> is the parameter, and type of it need be defined explicitly.</li>
<li><code>-&gt;</code> tells the return type is i32</li>
<li><code>x+1</code> is an expression, identical to <code>return x+1;</code></li>
</ul>
<h2 id="2-Methods"><a href="#2-Methods" class="headerlink" title="2. Methods"></a>2. Methods</h2><p>Methods are similar to functions, while theys are defined within the context of a struct (or an enum or a trait object), and their first parameter is always <strong>self</strong>, which represents the instance of the struct the method is being called on.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width * <span class="keyword">self</span>.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123;</span><br><span class="line">        width: <span class="number">30</span>,</span><br><span class="line">        height: <span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;The area of the rectangle is &#123;&#125; square pixels.&quot;</span>,</span><br><span class="line">        rect1.<span class="title function_ invoke__">area</span>()</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Associated-Methods"><a href="#3-Associated-Methods" class="headerlink" title="3. Associated Methods"></a>3. Associated Methods</h2><p>They are functions associated with a type but not tied to any particular instance of that type.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    radius: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="comment">// Associated function (static-like method)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Circle &#123; radius &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">pi</span>() <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="number">3.1415</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Method that takes `self` (instance method)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="number">3.1415</span> * <span class="keyword">self</span>.radius * <span class="keyword">self</span>.radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Calling the associated function</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle</span> = Circle::<span class="title function_ invoke__">new</span>(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calling an instance method on the created instance</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The area of the circle is &#123;&#125;&quot;</span>, circle.<span class="title function_ invoke__">area</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The PI is &#123;&#125;&quot;</span>, Circle::<span class="title function_ invoke__">pi</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Trait"><a href="#4-Trait" class="headerlink" title="4. Trait"></a>4. Trait</h2><p>Traits can be used to define shared behavior in an abstract way. They are similar to the idea of ‘interfaces’ in other programming languages.</p>
<h3 id="4-1-Defining-a-trait"><a href="#4-1-Defining-a-trait" class="headerlink" title="4.1 Defining a trait"></a>4.1 Defining a trait</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">    <span class="comment">//method with default implementation</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summary_type</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">        <span class="built_in">format!</span>(</span><br><span class="line">        <span class="string">&quot;This is beliong to Summary type,and here is a summary: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.<span class="title function_ invoke__">summarize</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Implementing-a-trait-on-a-type"><a href="#4-2-Implementing-a-trait-on-a-type" class="headerlink" title="4.2 Implementing a trait on a type"></a>4.2 Implementing a trait on a type</h3><p><strong>Restriction</strong>: to implement a trait on a type, either the trait or the type, or both are local to the crate.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Trait-as-Parameters"><a href="#4-3-Trait-as-Parameters" class="headerlink" title="4.3 Trait as Parameters"></a>4.3 Trait as Parameters</h3><h4 id="Trait-Bound-syntax"><a href="#Trait-Bound-syntax" class="headerlink" title="Trait Bound syntax"></a>Trait Bound syntax</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// is same as:</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//to narrow down with multiple traits:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br><span class="line"><span class="comment">//or:</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span>+ Display)) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Trait-Bounds-with-where-clauses"><a href="#Trait-Bounds-with-where-clauses" class="headerlink" title="Trait Bounds with where clauses"></a>Trait Bounds with <code>where</code> clauses</h4><p>Using <code>where</code> improves the readability of codes.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T&gt;(item: &amp;T)</span><br><span class="line"><span class="keyword">where</span> T: Summary + Display,</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">some_function</span>&lt;T, U&gt;(t: &amp;T, u: &amp;U) <span class="punctuation">-&gt;</span> <span class="type">i32</span></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: Display + <span class="built_in">Clone</span>,</span><br><span class="line">    U: <span class="built_in">Clone</span> + <span class="built_in">Debug</span>,</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-Trait-as-Return-Types"><a href="#4-4-Trait-as-Return-Types" class="headerlink" title="4.4 Trait as Return Types"></a>4.4 Trait as Return Types</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_summarizable</span>() <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Summary</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>One thing worth noticing is that <code>impl Summary</code> only allows single return type. e.g., the returns_summarizable can return <code>Tweet</code> only, not other Summary types.</p>
<p><strong>OR</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_summarizable</span>() <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Summary&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Control-flows"><a href="#5-Control-flows" class="headerlink" title="5, Control flows"></a>5, Control flows</h2><p>We will cover <code>if</code>, <code>loop</code>, and <code>while loop</code> in the following sections:</p>
<h3 id="5-1-if"><a href="#5-1-if" class="headerlink" title="5,1 if"></a>5,1 <code>if</code></h3><p><code>if</code> is quite simple, the only thing worth notcing is that the <code>condition</code> has to be a <code>bool</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 4&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 3&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 2&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is not divisible by 4, 3, or 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if</code> can be used as an expression, e.g.,<br>let number &#x3D; if true { 1 } else {0};</p>
<h3 id="5-2-loop"><a href="#5-2-loop" class="headerlink" title="5.2 loop"></a>5.2 loop</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">num</span>=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> num&lt;<span class="number">10</span> &#123;</span><br><span class="line">        num+=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;num is 10 now&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using loop label to continue or break to specified loop:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">&#x27;counting_up</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remaining</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> remaining == <span class="number">9</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">&#x27;counting_up</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Similar to <code>if</code>, loop can be used as an expression as well.</p>
<h3 id="5-3-while-loop"><a href="#5-3-while-loop" class="headerlink" title="5.3 while loop"></a>5.3 while loop</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> index &lt; <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;the value is: &#123;&#125;&quot;</span>, a[index]);</span><br><span class="line"></span><br><span class="line">    index += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0302-ownership/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0302-ownership/" itemprop="url">Rust lesson 3.2 - Ownership and reference</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T21:04:40+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Understanding-ownership"><a href="#Target-Understanding-ownership" class="headerlink" title="Target: Understanding ownership"></a>Target: Understanding ownership</h1><h2 id="1-Ownership"><a href="#1-Ownership" class="headerlink" title="1. Ownership"></a>1. Ownership</h2><h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><ul>
<li><p>Each value in Rust has an owner.</p>
<p><code>let my_string = String::from(&quot;abc&quot;);</code> my_string is the owner of the string.</p>
</li>
<li><p>There can only be one owner at a time.</p>
<p><code>let str1 = my_string;</code> str1 is the owner, and my_string is no longer valid.</p>
</li>
<li><p>When the owner goes out of scope, the value will be dropped.</p>
<p><code>&#123;&#125;</code> defines the scope; the variable is no longer valid outside its scope.</p>
</li>
</ul>
<h2 id="2-Reference"><a href="#2-Reference" class="headerlink" title="2. Reference"></a>2. Reference</h2><p>Reference: accessing a variable without changing the ownership.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">abc_owner</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">abc_ref</span> = &amp;abc_owner; <span class="comment">// abc_ref is a reference. abc_owner is still the owner.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">efg_owner</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;efg&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">efg_ref</span> = &amp;<span class="keyword">mut</span> efg_owner; <span class="comment">// efg_ref is a mutable reference.</span></span><br><span class="line">efg_ref.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;hik&quot;</span>); <span class="comment">// efg_owner is now &quot;efghik&quot;.</span></span><br></pre></td></tr></table></figure>

<h3 id="Limitation-of-Reference"><a href="#Limitation-of-Reference" class="headerlink" title="Limitation of Reference"></a>Limitation of Reference</h3><p>The rule of reference is quite similar to read&#x2F;write lock:<br>A variable can have 1 ‘&amp;mut’ reference or multiple ‘&amp;’ reference.</p>
<h3 id="Scope-of-references"><a href="#Scope-of-references" class="headerlink" title="Scope of references"></a>Scope of references</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span>=<span class="type">String</span>::fr <span class="title function_ invoke__">om</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">r1</span>=&amp;s;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">r2</span>=&amp;s;</span><br><span class="line"><span class="built_in">println!</span>&#123;<span class="string">&quot;&#123;r1&#125; and &#123;r2&#125;&quot;</span>&#125;; <span class="comment">//r1 and r2 are no longer refered after this</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r3</span> = &amp;<span class="keyword">mut</span> s; <span class="comment">//r3 is the only ref of s</span></span><br><span class="line"><span class="title function_ invoke__">println</span>(<span class="string">&quot;&#123;r3&#125;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-Variables-in-memory"><a href="#3-Variables-in-memory" class="headerlink" title="3. Variables in memory"></a>3. Variables in memory</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span>=x;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x = &#123;x&#125;, y = &#123;y&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>=<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>=s2</span><br><span class="line"><span class="comment">//println!(&quot;s1 = &#123;s1&#125;, s2 = &#123;s2&#125;&quot;); s1 is not valid here</span></span><br></pre></td></tr></table></figure>

<p>In this example we can see the primitive type (integer) behaves differently comparing to String. There are several reason:</p>
<ul>
<li>primitive variables are stored in the stack(cheap), while other types are stored in the heap(expansive).</li>
<li>Primitive variables implemented ‘copy’ trait, ‘y&#x3D;x’ actually creates a copy of ‘x’ and assigns it to ‘y’</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">str_literal</span>=<span class="string">&quot;abc&quot;</span>; <span class="comment">// &amp;str, stored distinctly from heap and stack</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>=<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>); <span class="comment">//String</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1_ref</span>=&amp;s1; <span class="comment">//&amp;String</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>=s1.<span class="title function_ invoke__">clone</span>() <span class="comment">//String, a separated instance in memory</span></span><br></pre></td></tr></table></figure>

<h2 id="4-mut"><a href="#4-mut" class="headerlink" title="4. mut"></a>4. <code>mut</code></h2><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">5</span>;</span><br><span class="line"><span class="comment">//a=6; This is Not allowed since a is immutable</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">b</span>=<span class="number">10</span>;</span><br><span class="line">b=<span class="number">11</span>; <span class="comment">//This is fine</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span>= &amp;<span class="keyword">mut</span> b;</span><br><span class="line"><span class="comment">//c=12; This is Not allowed, because c is immutable</span></span><br><span class="line"><span class="comment">//b=12; This is Not allowed because a value can only have one mutable reference which is &#x27;c&#x27;</span></span><br><span class="line">*c=<span class="number">12</span>; <span class="comment">//This is fine</span></span><br><span class="line"><span class="comment">//println!(&quot;value of b is &#123;&#125;&quot;, b);  Not allowed because b is borrowed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">d</span> = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">e</span> = <span class="number">30</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;d is &#123;&#125;, e is &#123;&#125;&quot;</span>, d, e); <span class="comment">// d is 20, e is 30</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = &amp;<span class="keyword">mut</span> d; <span class="comment">// f is a mutable reference to the mutable reference of d;</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//20</span></span><br><span class="line">*f = <span class="number">21</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//21</span></span><br><span class="line"><span class="comment">//println!(&quot;d is &#123;&#125;, f is &#123;&#125;&quot;, d, f); this is not allowed, f holds the exclusive reference of d, d is temporarily invalid</span></span><br><span class="line">f = &amp;<span class="keyword">mut</span> e;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;f is &#123;&#125;&quot;</span>, f); <span class="comment">//30</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;d is &#123;&#125;, f is &#123;&#125;&quot;</span>, d, f); <span class="comment">// This is fine because f released the reference to d.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Meaning-of-mut"><a href="#Meaning-of-mut" class="headerlink" title="Meaning of mut"></a>Meaning of <code>mut</code></h3><ul>
<li>The declared variable can be modified<ul>
<li><pre><code class="rust">  lex mut x=5;
  x=6;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- ```rust</span><br><span class="line">    let mut a = String::form(&quot;abc&quot;);</span><br><span class="line">    a = String::form(&quot;efg&quot;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><code>&amp;mut</code> creats a mutable reference of a value. For example <code>let mut a = &amp;mut b;</code> meaning:<ul>
<li><code>a</code> would hold the exclusive access to b until <code>a</code> is out of scope.</li>
<li>The ownership of <code>b</code> will not changed, when <code>a</code> is no longer valid, the exclusive access will return to <code>b</code></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/08/rust-0301-types/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/08/rust-0301-types/" itemprop="url">Rust lesson 3.1 - Data Types</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-08T20:14:34+08:00">
                2024-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Getting-familiar-with-Data-types"><a href="#Target-Getting-familiar-with-Data-types" class="headerlink" title="Target: Getting familiar with Data types"></a>Target: Getting familiar with Data types</h1><h2 id="1-Scalar-Types"><a href="#1-Scalar-Types" class="headerlink" title="1. Scalar Types"></a>1. Scalar Types</h2><h3 id="1-1-Integer"><a href="#1-1-Integer" class="headerlink" title="1.1 Integer"></a>1.1 Integer</h3><h4 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h4><ul>
<li>i: signed</li>
<li>u: unsigned</li>
</ul>
<table>
<thead>
<tr>
<th>Length</th>
<th>Signed</th>
<th>Unsigned</th>
</tr>
</thead>
<tbody><tr>
<td><strong>8-bit</strong></td>
<td>i8</td>
<td>u8</td>
</tr>
<tr>
<td><strong>16-bit</strong></td>
<td>i16</td>
<td>u16</td>
</tr>
<tr>
<td><strong>32-bit</strong></td>
<td>i32</td>
<td>u32</td>
</tr>
<tr>
<td><strong>64-bit</strong></td>
<td>i64</td>
<td>u64</td>
</tr>
<tr>
<td><strong>128-bit</strong></td>
<td>i128</td>
<td>u128</td>
</tr>
<tr>
<td><strong>arch</strong></td>
<td>isize</td>
<td>usize</td>
</tr>
</tbody></table>
<h4 id="Integer-Literals"><a href="#Integer-Literals" class="headerlink" title="Integer Literals"></a>Integer Literals</h4><table>
<thead>
<tr>
<th>Number literals</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>Decimal</td>
<td>98_222</td>
</tr>
<tr>
<td>Hex</td>
<td>0xff</td>
</tr>
<tr>
<td>Octal</td>
<td>0o77</td>
</tr>
<tr>
<td>Binary</td>
<td>0b1111_0000</td>
</tr>
<tr>
<td>Byte (u8 only)</td>
<td>b’A’</td>
</tr>
</tbody></table>
<h3 id="1-2-Floating-Point"><a href="#1-2-Floating-Point" class="headerlink" title="1.2 Floating-Point"></a>1.2 Floating-Point</h3><p><code>f32, f64</code></p>
<p><strong>These will lose precision in the arithmetic, using integer instead</strong></p>
<h3 id="1-3-Boolean"><a href="#1-3-Boolean" class="headerlink" title="1.3 Boolean"></a>1.3 Boolean</h3><p>true&#x2F;false</p>
<h3 id="1-4-Character"><a href="#1-4-Character" class="headerlink" title="1.4 Character"></a>1.4 Character</h3><p>In rust, char can store any valid Unicaode(up to 4bytes).</p>
<p><code>&quot;a 你好&quot;</code></p>
<ul>
<li>‘a’: 1 byte (0x61)</li>
<li>‘你’: 3 bytes (0xe4 0xbd 0xa0)</li>
<li>‘好’: 3 bytes (0xe5 a5 bd)</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">text</span> = <span class="string">&quot;a你好&quot;</span>;</span><br><span class="line"><span class="comment">// Byte length of the string</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Byte length: &#123;&#125;&quot;</span>, text.<span class="title function_ invoke__">len</span>()); <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Character length of the string</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Character length: &#123;&#125;&quot;</span>, text.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">count</span>()); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Loop through every character</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> text.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;Character: &#123;&#125;&quot;</span>, c); <span class="comment">//a你好</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">ni</span> = text.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">nth</span>(<span class="number">1</span>); <span class="comment">//Some(你)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">char_a</span>=text[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//text[1]: this will NOT work, becease 你 is a slice from 1 to 3(text[1..4]), and spliting is not allowed</span></span><br></pre></td></tr></table></figure>

<h2 id="2-Compound-Types"><a href="#2-Compound-Types" class="headerlink" title="2. Compound Types"></a>2. Compound Types</h2><h3 id="2-1-Arrays"><a href="#2-1-Arrays" class="headerlink" title="2.1 Arrays"></a>2.1 Arrays</h3><ul>
<li>fixed length</li>
<li>same type</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]; <span class="comment">//</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = [<span class="number">3</span>; <span class="number">5</span>]; <span class="comment">//[3, 3, 3, 3, 3];</span></span><br><span class="line"><span class="comment">//to loop over the array</span></span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span> <span class="keyword">in</span> a.iter&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> <span class="title class_">n</span>:&amp;<span class="type">i32</span>  <span class="keyword">in</span> &amp;a &#123;&#125;</span><br><span class="line"><span class="comment">//to access the value by its index</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;The first element in the array b is &#123;&#125;&quot;</span>, b[<span class="number">0</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Structs"><a href="#2-2-Structs" class="headerlink" title="2.2 Structs"></a>2.2 Structs</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//regular</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//tuple struct</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"><span class="comment">//unit</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/24/rust-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/24/rust-02/" itemprop="url">Rust lesson 2 - Rust basics</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-24T20:02:54+08:00">
                2024-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Getting-familiar-with-basics"><a href="#Target-Getting-familiar-with-basics" class="headerlink" title="Target: Getting familiar with basics"></a>Target: Getting familiar with basics</h1><h2 id="1-Variables-and-Mutability"><a href="#1-Variables-and-Mutability" class="headerlink" title="1. Variables and Mutability"></a>1. Variables and Mutability</h2><h3 id="1-1-Variables"><a href="#1-1-Variables" class="headerlink" title="1.1 Variables"></a>1.1 Variables</h3><p>To define a variable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let x=5;</span><br><span class="line">//x=6 would throw an error</span><br></pre></td></tr></table></figure>

<p>By default, the ‘x’ is immutabel, to make a variable mutable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut x=5;</span><br><span class="line">x=6;</span><br></pre></td></tr></table></figure>

<h4 id="Shadowing"><a href="#Shadowing" class="headerlink" title="Shadowing"></a>Shadowing</h4><p>Declaring a new variable with the same name as a previous variable, this is true for both mutable and immutable variables.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>; <span class="comment">//6</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = x * <span class="number">2</span>; <span class="comment">// 12</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value of x in the inner scope is: &#123;x&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>); <span class="comment">//6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The shadowing variable can be defined as the different data type:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let spaces = &quot;   &quot;;</span><br><span class="line">let spaces = spaces.len();</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Constant"><a href="#1-2-Constant" class="headerlink" title="1.2 Constant"></a>1.2 Constant</h3><p>To define a constant:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;</span><br></pre></td></tr></table></figure>

<p>Comparing to variables, the constant:</p>
<ul>
<li>is always immutable</li>
<li>annote the type explicitly</li>
<li>naming in uppercase fashion</li>
<li>value must be defined in the declaration</li>
<li>can not be shadowed</li>
</ul>
<h3 id="1-3-Static"><a href="#1-3-Static" class="headerlink" title="1.3 Static"></a>1.3 Static</h3><p>To define a static:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;</span><br></pre></td></tr></table></figure>

<p>Comparing to constant, the static:</p>
<ul>
<li>can be mutable with ‘mut’ keyword, but this is NOT SAFE (surrounded in a ‘unsafe’ block).</li>
<li>in the runtime, the constant is the acutual value compiler would replace it in the compilation. while static is alway pointing to the address.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/23/rust-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/23/rust-01/" itemprop="url">Rust lesson 1 - Hello World!</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-23T20:12:52+08:00">
                2024-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Setting-up-Rust-development-environment"><a href="#Target-Setting-up-Rust-development-environment" class="headerlink" title="Target: Setting up Rust development environment"></a>Target: Setting up Rust development environment</h1><h2 id="1-Installation"><a href="#1-Installation" class="headerlink" title="1. Installation"></a>1. Installation</h2><p>Installing rustup in terminal:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 https://sh.rustup.rs -sSf | sh</span><br></pre></td></tr></table></figure>

<p>To check whether your installion successed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rustc --version</span><br></pre></td></tr></table></figure>

<h2 id="2-Setting-up-IDE-VS-Code"><a href="#2-Setting-up-IDE-VS-Code" class="headerlink" title="2. Setting up IDE (VS Code)"></a>2. Setting up IDE (VS Code)</h2><p>If you are going to code rust with vs code, here are some usfer plugins:</p>
<ol>
<li>rust-analyzer</li>
<li>Even Better TOML</li>
<li>Dependi (a modern <code>cartes</code>)</li>
</ol>
<h2 id="3-Hello-World"><a href="#3-Hello-World" class="headerlink" title="3. Hello World"></a>3. Hello World</h2><p>To run our frist rust functio, we can simply create a ‘.rs’ file, e.g., ‘main.rs’:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then building it with command <code>rustc main.rs</code>, there would be a binary file ‘main’. And the file can be executed in your terminal or other command line tools.</p>
<h2 id="4-Cargo"><a href="#4-Cargo" class="headerlink" title="4. Cargo"></a>4. Cargo</h2><p>Cargo is Rust’s build system and package manager. It is a great tool helping developers building the codes and managing the dependices.</p>
<ol>
<li>Creating a Project with Cargo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new hello_cargo</span><br></pre></td></tr></table></figure></li>
<li>Build the project<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br></pre></td></tr></table></figure>
This command creates an executable file in target&#x2F;debug&#x2F;hello_cargo, similar to building with ‘rustc’.</li>
<li>Build and Run<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run</span><br></pre></td></tr></table></figure></li>
<li>Just compile without producing an executable<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo check</span><br></pre></td></tr></table></figure></li>
<li>Building for Release<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build --release</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="5-Dependencies-management-with-cargo"><a href="#5-Dependencies-management-with-cargo" class="headerlink" title="5. Dependencies management with cargo"></a>5. Dependencies management with cargo</h2><p>Dependencis of the project are listed in the ‘Cargo.toml’ file, for example:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello_cargo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">rand</span>=<span class="string">&quot;0.8.5&quot;</span></span><br></pre></td></tr></table></figure>

<p>In this example, a ‘rand’ library is added.</p>
<h3 id="The-remote-repository-of-Cargo-dependencis-optional"><a href="#The-remote-repository-of-Cargo-dependencis-optional" class="headerlink" title="The remote repository of Cargo dependencis[optional]"></a>The remote repository of Cargo dependencis[optional]</h3><p>Sometimes, we want to change the remote repository for fatser downloading, the default source can be override by adding follow configuration in ‘$HOME&#x2F;.cargo&#x2F;config.toml’:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[source.crates-io]</span></span><br><span class="line"><span class="attr">replace-with</span> = <span class="string">&#x27;ustc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[source.ustc]</span></span><br><span class="line"><span class="attr">registry</span> = <span class="string">&quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/16/Solidity-lesson4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/16/Solidity-lesson4/" itemprop="url">Solidity Lesson 4 - Upgradeable Smart Contracts</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-16T21:38:26+08:00">
                2024-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Understanding-Upgradeable-Smart-Contracts"><a href="#Target-Understanding-Upgradeable-Smart-Contracts" class="headerlink" title="Target: Understanding Upgradeable Smart Contracts"></a>Target: Understanding Upgradeable Smart Contracts</h1><h2 id="1-Key-concepts"><a href="#1-Key-concepts" class="headerlink" title="1. Key concepts"></a>1. Key concepts</h2><h3 id="1-1-Fallback-function"><a href="#1-1-Fallback-function" class="headerlink" title="1.1 Fallback function"></a>1.1 Fallback function</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fallback() external payable&#123;&#125;</span><br><span class="line">receieve() external payable&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>fallback</strong> is a special function that is executed either when</p>
<ul>
<li>a function that does not exist is called or</li>
<li>Ether is sent directly to a contract but receive() does not exist or msg.data is not empty</li>
</ul>
<h3 id="1-2-Delegatecall-function"><a href="#1-2-Delegatecall-function" class="headerlink" title="1.2 Delegatecall function"></a>1.2 Delegatecall function</h3><p><strong>delegatecall</strong> is a low level function similar to <code>call</code>.<br>When contract A executes delegatecall to contract B, B’s code is executed with contract A’s storage, <code>msg.sender</code> and <code>msg.value</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">// NOTE: Deploy this contract first</span><br><span class="line">contract B &#123;</span><br><span class="line">    // NOTE: storage layout must be the same as contract A</span><br><span class="line">    uint256 public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setVars(uint256 _num) public payable &#123;</span><br><span class="line">        num = _num;</span><br><span class="line">        sender = msg.sender;</span><br><span class="line">        value = msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    uint256 public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setVars(address _contract, uint256 _num) public payable &#123;</span><br><span class="line">        // A&#x27;s storage is set, B is not modified.</span><br><span class="line">        (bool success, bytes memory data) = _contract.delegatecall(</span><br><span class="line">            abi.encodeWithSignature(&quot;setVars(uint256)&quot;, _num)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-Storage"><a href="#1-3-Storage" class="headerlink" title="1.3 Storage"></a>1.3 Storage</h3><ul>
<li>Storage Slot Assignment: In Solidity, state variables are assigned to storage slots in the order they are declared:<ul>
<li>The first declared variable is stored in slot 0.</li>
<li>The second in slot 1, and so on.</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract MyImplementation &#123;</span><br><span class="line">    uint256 public value;  // Stored in slot 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Proxy Contract Storage: Even though the proxy contract doesn’t explicitly declare a value variable, its storage layout is still accessible to the implementation contract when delegatecall is used.<br>When delegatecall is invoked:</li>
<li>The value variable in MyImplementation refers to storage slot 0.</li>
<li>This slot 0 is located in the proxy contract’s storage.<br>Thus, when MyImplementation’s setValue function is called through the proxy:</li>
<li>The value in slot 0 of the proxy’s storage is updated.</li>
</ul>
<h2 id="2-The-idea-of-Upgradeable-contracts"><a href="#2-The-idea-of-Upgradeable-contracts" class="headerlink" title="2. The idea of Upgradeable contracts"></a>2. The idea of Upgradeable contracts</h2><p>Now, we have learnt the basics, the idea of upgradeable contracts is based on this:</p>
<ol>
<li>Undefined function calls to the proxy contract can be handled by the fallback function which will make a <code>delegatecall</code> to respective implementation contracts.</li>
<li><code>delegatecall</code> would only modify the proxy contract’s state variables, as long as those variables’ slot position and type are identical to implememtation contracts’, everything will works fine.</li>
</ol>
<h2 id="3-Patterns-of-Upgradeable-contracts"><a href="#3-Patterns-of-Upgradeable-contracts" class="headerlink" title="3. Patterns of Upgradeable contracts"></a>3. Patterns of Upgradeable contracts</h2><h3 id="3-1-Transparent-Proxy"><a href="#3-1-Transparent-Proxy" class="headerlink" title="3.1 Transparent Proxy"></a>3.1 Transparent Proxy</h3><p>Separates admin and user roles clearly, with the proxy itself handling upgrades and admin functions.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract Implementation &#123;</span><br><span class="line">    uint256 public value;</span><br><span class="line"></span><br><span class="line">    function setValue(uint256 _value) external &#123;</span><br><span class="line">        value = _value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract TransparentProxy &#123;</span><br><span class="line">    address private _implementation;</span><br><span class="line">    address private _admin;</span><br><span class="line"></span><br><span class="line">    constructor(address implementation_, address admin_) &#123;</span><br><span class="line">        _implementation = implementation_;</span><br><span class="line">        _admin = admin_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyAdmin() &#123;</span><br><span class="line">        require(msg.sender == _admin, &quot;Not admin&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function upgradeTo(address newImplementation) external onlyAdmin &#123;</span><br><span class="line">        _implementation = newImplementation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _delegate(address implementation) internal &#123;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            // Copy the call data.</span><br><span class="line">            calldatacopy(0, 0, calldatasize())</span><br><span class="line"></span><br><span class="line">            // Delegate the call to the implementation.</span><br><span class="line">            let result := delegatecall(gas(), implementation, 0, calldatasize(), 0, 0)</span><br><span class="line"></span><br><span class="line">            // Copy the returned data.</span><br><span class="line">            returndatacopy(0, 0, returndatasize())</span><br><span class="line"></span><br><span class="line">            // Return the result of the call.</span><br><span class="line">            switch result</span><br><span class="line">            case 0 &#123; revert(0, returndatasize()) &#125;</span><br><span class="line">            default &#123; return(0, returndatasize()) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        if (msg.sender == _admin) &#123;</span><br><span class="line">            // If the caller is the admin, do nothing.</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // Otherwise, delegate the call to the implementation.</span><br><span class="line">        _delegate(_implementation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;</span><br><span class="line">        // Allow the contract to receive ETH.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract ProxyAdmin &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;Not owner&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function changeProxyAdmin(TransparentProxy proxy, address newAdmin) external onlyOwner &#123;</span><br><span class="line">        proxy.upgradeTo(newAdmin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function upgrade(TransparentProxy proxy, address newImplementation) external onlyOwner &#123;</span><br><span class="line">        proxy.upgradeTo(newImplementation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, ProxyAdmin is used to control the proxy, and it is not necessary, especially for a single proxy scenario. The ProxyAdmin contract is an additional layer used to manage the proxy contract</p>
<h3 id="3-2-UUPS-Universal-Upgradeable-Proxy-Standard"><a href="#3-2-UUPS-Universal-Upgradeable-Proxy-Standard" class="headerlink" title="3.2 UUPS(Universal Upgradeable Proxy Standard)"></a>3.2 UUPS(Universal Upgradeable Proxy Standard)</h3><p>Places more responsibility on the implementation contract for managing upgrades, offering more flexibility but requiring careful management.</p>
<h3 id="3-3-Diamond-EIP-2535"><a href="#3-3-Diamond-EIP-2535" class="headerlink" title="3.3 Diamond(EIP-2535)"></a>3.3 Diamond(EIP-2535)</h3><p>Allowing for more complex upgradeable contracts, specifically those with multiple facets, each containing different functions. This pattern is highly flexible and allows contracts to scale without becoming monolithic.</p>
<hr>
<h3 id="Comparison-Table"><a href="#Comparison-Table" class="headerlink" title="Comparison Table:"></a>Comparison Table:</h3><table>
<thead>
<tr>
<th>Feature</th>
<th>Transparent Proxy</th>
<th>UUPS</th>
<th>Diamond (EIP-2535)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Upgrade Control</strong></td>
<td>Separate <code>ProxyAdmin</code> contract</td>
<td>Managed by implementation</td>
<td>Managed by facets</td>
</tr>
<tr>
<td><strong>Gas Efficiency</strong></td>
<td>More expensive (extra contract)</td>
<td>More gas-efficient</td>
<td>Potentially higher due to complexity</td>
</tr>
<tr>
<td><strong>Modularity</strong></td>
<td>Limited</td>
<td>Limited</td>
<td>Highly modular</td>
</tr>
<tr>
<td><strong>Admin Management</strong></td>
<td>Proxy admin vs user roles</td>
<td>Admin is in charge of upgrades</td>
<td>More complex admin control</td>
</tr>
<tr>
<td><strong>Upgradeability Granularity</strong></td>
<td>Entire implementation contract</td>
<td>Entire implementation contract</td>
<td>Upgrade individual facets</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Medium</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td><strong>Best Use Case</strong></td>
<td>DeFi, stable projects</td>
<td>Small apps or simple systems</td>
<td>Large modular platforms</td>
</tr>
</tbody></table>
<h3 id="Choosing-Between-Transparent-Proxy-UUPS-and-Diamond"><a href="#Choosing-Between-Transparent-Proxy-UUPS-and-Diamond" class="headerlink" title="Choosing Between Transparent Proxy, UUPS, and Diamond"></a>Choosing Between Transparent Proxy, UUPS, and Diamond</h3><ol>
<li><p><strong>Transparent Proxy</strong>:</p>
<ul>
<li>Best for established systems that need clear separation between users and admin.</li>
<li>Most widely used, considered more secure and tested, but a bit more complex.</li>
<li>Suitable for DeFi protocols or projects with high stakes and security needs.</li>
</ul>
</li>
<li><p><strong>UUPS</strong>:</p>
<ul>
<li>Ideal for lightweight contracts or simpler systems where ease of use and efficiency is more important.</li>
<li>You still have upgradeability without the overhead of managing a separate <code>ProxyAdmin</code> contract.</li>
</ul>
</li>
<li><p><strong>Diamond (EIP-2535)</strong>:</p>
<ul>
<li>Perfect for complex, modular systems that need to scale. If you’re building a platform that will continuously evolve with new features, Diamond’s facet-based architecture offers significant flexibility.</li>
<li>Adds complexity but provides long-term benefits in terms of modular upgrades.</li>
</ul>
</li>
</ol>
<p>Each upgrade pattern has its strengths, and the best choice depends on the complexity, gas efficiency, and upgrade requirements of your project.</p>
<h2 id="3-One-more-thing-about-Storage-slot"><a href="#3-One-more-thing-about-Storage-slot" class="headerlink" title="3. One more thing about Storage slot"></a>3. One more thing about Storage slot</h2><h3 id="Modular-storage"><a href="#Modular-storage" class="headerlink" title="Modular storage"></a>Modular storage</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">struct AppStorage &#123;</span><br><span class="line">    uint256 a;</span><br><span class="line">    uint8 b;</span><br><span class="line">    uint8 c;</span><br><span class="line">    uint8 d;</span><br><span class="line">    address contractA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">library Storage &#123;</span><br><span class="line">    bytes32 constant KEY = keccak256(&quot;storage-local&quot;);</span><br><span class="line"></span><br><span class="line">    function get() internal pure returns (AppStorage storage s) &#123;</span><br><span class="line">        bytes32 loc = KEY;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            s.slot := loc</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This allows the storage layout to be shared across different facets or functions, avoiding conflicts between different components.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/16/Solidity-lesson3.3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/16/Solidity-lesson3.3/" itemprop="url">Solidity Lesson 3.3 - Randomness</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-16T14:51:33+08:00">
                2024-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Blockchain-Ethereum-Randomness-101"><a href="#Target-Blockchain-Ethereum-Randomness-101" class="headerlink" title="Target: Blockchain(Ethereum) Randomness 101"></a>Target: Blockchain(Ethereum) Randomness 101</h1><h2 id="1-Code-Example"><a href="#1-Code-Example" class="headerlink" title="1. Code Example"></a>1. Code Example</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">contract Hero &#123;</span><br><span class="line">    enum HeroType &#123;</span><br><span class="line">        Mege,</span><br><span class="line">        Healer,</span><br><span class="line">        Barbarian</span><br><span class="line">    &#125;</span><br><span class="line">    mapping(address =&gt; uint256[]) private addressToHeroType;</span><br><span class="line"></span><br><span class="line">    function getHeros() public view returns (uint256[] memory) &#123;</span><br><span class="line">        return addressToHeroType[msg.sender];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createHero(HeroType _type) public payable &#123;</span><br><span class="line">        require(msg.value &gt;= 0.5 ether, &quot;please send at least 0.5 eth&quot;);</span><br><span class="line"></span><br><span class="line">        uint256[] memory stats = new uint[](5);</span><br><span class="line">        stats[0] = 2;</span><br><span class="line">        stats[1] = 7;</span><br><span class="line">        stats[2] = 12;</span><br><span class="line">        stats[3] = 17;</span><br><span class="line">        stats[4] = 22;</span><br><span class="line"></span><br><span class="line">        uint256 len = 5;</span><br><span class="line">        uint h = uint256(_type);</span><br><span class="line"></span><br><span class="line">        do &#123;</span><br><span class="line">            uint256 pos = generateRandom() % len;</span><br><span class="line">            uint256 value = (generateRandom() % (13 + len)) + 1;</span><br><span class="line">            h |= value &lt;&lt; stats[pos];</span><br><span class="line">            len--;</span><br><span class="line">            stats[pos] = stats[len];</span><br><span class="line">        &#125; while (len &gt; 0);</span><br><span class="line"></span><br><span class="line">        addressToHeroType[msg.sender].push(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function generateRandom() public view returns (uint256) &#123;</span><br><span class="line">        return</span><br><span class="line">            uint256(</span><br><span class="line">                keccak256(</span><br><span class="line">                    abi.encodePacked(</span><br><span class="line">                        block.prevrandao,</span><br><span class="line">                        block.timestamp,</span><br><span class="line">                        msg.sender</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-Why-the-generateRandom-is-insecure"><a href="#1-Why-the-generateRandom-is-insecure" class="headerlink" title="1. Why the generateRandom() is insecure"></a>1. Why the <code>generateRandom()</code> is insecure</h3><p><strong>Randomness via On-Chain Data (e.g., block.timestamp, block.prevrandao)</strong></p>
<pre><code>Using data like block.timestamp, block.prevrandao, and msg.sender is a common approach for generating “random” numbers in smart contracts. The idea is to take some data that varies from block to block and hash it (usually with keccak256), which gives a result that looks random but is predictable for someone who knows all the inputs.
</code></pre>
<h3 id="2-Other-issues"><a href="#2-Other-issues" class="headerlink" title="2. Other issues"></a>2. Other issues</h3><ul>
<li>shall we store the ‘stats’ other places to save gas?<ul>
<li><strong>in ‘storage’</strong>? NO! Reading from and writing to storage is much more expensive than working with memory. Storing a small, fixed-size array in storage may increase gas costs rather than reduce them.</li>
<li><strong>specifing it as ‘constant’?</strong> it is a good idea, however, only primitive time and fixed-sized byte array can be specified as ‘constant’</li>
<li><strong>specifing it as ‘immutable’?</strong> similar to ‘constant’, array can not specified as ‘immutable’.</li>
</ul>
</li>
<li><code>stats[pos] = stats[len];</code><br>This is very similar to the swap in the quicksort</li>
</ul>
<h2 id="2-Chainlink-VRF-2-5"><a href="#2-Chainlink-VRF-2-5" class="headerlink" title="2. Chainlink VRF 2.5"></a>2. Chainlink VRF 2.5</h2><h3 id="True-randomness-can-only-be-generated-off-chain"><a href="#True-randomness-can-only-be-generated-off-chain" class="headerlink" title="True randomness can only be generated off-chain"></a>True randomness can only be generated off-chain</h3><p><strong>Deterministic nature of blockchain</strong>: The Ethereum blockchain, like most blockchains, operates in a deterministic manner. This means that every operation performed on the blockchain must produce the same result for all nodes in the network. This determinism is essential to ensure consensus among all nodes, allowing them to agree on the state of the blockchain.</p>
<ul>
<li>Consensus: All nodes in the Ethereum network must be able to independently verify transactions and blocks to reach consensus.</li>
<li>Security: Determinism ensures that the outcome of a transaction is predictable and verifiable by anyone running an Ethereum node.</li>
</ul>
<h3 id="How-to-use-chainlink-VRF"><a href="#How-to-use-chainlink-VRF" class="headerlink" title="How to use chainlink VRF"></a>How to use chainlink VRF</h3><p><a target="_blank" rel="noopener" href="https://docs.chain.link/vrf/v2-5/subscription/get-a-random-number">Chainlink VRF2.5</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/15/Solidity-lesson3.2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/15/Solidity-lesson3.2/" itemprop="url">Solidity Lesson 3.2 - Connecting to Metamask II</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-15T10:41:34+08:00">
                2024-09-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Learn-how-to-send-transactions-write-to-chain"><a href="#Target-Learn-how-to-send-transactions-write-to-chain" class="headerlink" title="Target: Learn how to send transactions (write to chain)"></a>Target: Learn how to send transactions (write to chain)</h1><h2 id="1-Issues-I-encountered"><a href="#1-Issues-I-encountered" class="headerlink" title="1. Issues I encountered"></a>1. Issues I encountered</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//prompt for permission if no connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">BrowserProvider</span>(<span class="title function_">getEth</span>());</span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;function getCount() public view returns (uint256)&quot;</span>,</span><br><span class="line">      <span class="string">&quot;function count() public&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="keyword">await</span> provider.<span class="title function_">getSigner</span>() <span class="comment">//provider or signer</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//debug</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(contract);</span><br><span class="line">  <span class="comment">//interaction with contract</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    counter.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">incremnet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">await</span> contract.<span class="title function_">count</span>();</span><br><span class="line">    <span class="keyword">await</span> tx.<span class="title function_">wait</span>();</span><br><span class="line">    <span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setup html</span></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.<span class="property">innerHTML</span> = <span class="string">&quot;increment&quot;</span>;</span><br><span class="line"></span><br><span class="line">  btn.<span class="property">onclick</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">incremnet</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(counter);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn);</span><br><span class="line">  <span class="comment">//display count when page refreshing</span></span><br><span class="line">  <span class="title function_">getCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>contract.count is not a function</code></p>
<p>Cause: a redundant white space when copying the function signature to the abi part.</p>
</li>
<li><p><code>Nonce too high. Expected nonce to be 2 but got 9. Note that transactions can&#39;t be queued when automining.</code></p>
<p>Cause: Metamask cache, by clearing it will fix this.</p>
</li>
</ul>
<h2 id="2-Event-listener"><a href="#2-Event-listener" class="headerlink" title="2. Event listener"></a>2. Event listener</h2><p>Contract:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.24;</span><br><span class="line"></span><br><span class="line">contract Counter &#123;</span><br><span class="line">    event countIncremented(address indexed user, uint256 count);</span><br><span class="line"></span><br><span class="line">    uint256 private s_counter;</span><br><span class="line"></span><br><span class="line">    function count() public &#123;</span><br><span class="line">        s_counter++;</span><br><span class="line">        emit countIncremented(msg.sender, s_counter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getCount() public view returns (uint256) &#123;</span><br><span class="line">        return s_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; abi &#125; <span class="keyword">from</span> <span class="string">&quot;../artifacts/contracts/Counter.sol/Counter.json&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//prompt for permission if no connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return connected accounts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">BrowserProvider</span>(<span class="title function_">getEth</span>()); <span class="comment">//ethers v6</span></span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    abi,</span><br><span class="line">    <span class="keyword">await</span> provider.<span class="title function_">getSigner</span>() <span class="comment">//provider or signer</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//debug</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(contract);</span><br><span class="line">  <span class="comment">//interaction with contract</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    counter.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">getCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">incremnet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> contract.<span class="title function_">count</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//&#x27;contract.on&#x27; &#x27;listeners</span></span><br><span class="line">  <span class="comment">//filtering all</span></span><br><span class="line">  contract.<span class="title function_">on</span>(<span class="string">&quot;countIncremented&quot;</span>, <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">    counter.<span class="property">innerHTML</span> = count.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//filtering certain sender</span></span><br><span class="line">  contract.<span class="title function_">on</span>(</span><br><span class="line">    contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">      <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">      counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//this won&#x27;t work since &#x27;count&#x27; is not indexed</span></span><br><span class="line">  contract.<span class="title function_">on</span>(</span><br><span class="line">    contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">      <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">      <span class="number">10</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">      counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">//setup html</span></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.<span class="property">innerHTML</span> = <span class="string">&quot;increment&quot;</span>;</span><br><span class="line"></span><br><span class="line">  btn.<span class="property">onclick</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">incremnet</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(counter);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn);</span><br><span class="line">  <span class="comment">//display count when page refreshing</span></span><br><span class="line">  <span class="title function_">getCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<h3 id="contract-on"><a href="#contract-on" class="headerlink" title="contract.on"></a><code>contract.on</code></h3><p>contract.on(“eventName”, callback) listens for the event emitted by the contract.</p>
<ol>
<li>filtering all</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract.<span class="title function_">on</span>(<span class="string">&quot;countIncremented&quot;</span>, <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">  counter.<span class="property">innerHTML</span> = count.<span class="title function_">toString</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>filtering indexed arguments</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract.<span class="title function_">on</span>(</span><br><span class="line">  contract.<span class="property">filters</span>.<span class="title function_">countIncremented</span>(</span><br><span class="line">    <span class="string">&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;</span>,</span><br><span class="line">    <span class="literal">null</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="title function_">async</span> (user, count) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Filtered event: new count: <span class="subst">$&#123;count&#125;</span>, user: <span class="subst">$&#123;user&#125;</span>`</span>);</span><br><span class="line">    counter.<span class="property">innerHTML</span> = count;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>if there are no specific criteras to filter, <code>&quot;countIncremented&quot;</code> and <code>contract.filters.countIncremented()</code>both world work. but the arguments of callback function has to follow the order of event.</li>
<li>if there are indexed arguments to filter, all the arguments need to be listed in the filter, e.g., <code>contract.filters.countIncremented(&quot;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&quot;,null ),</code>.</li>
<li>non-indexed arguments CAN NOT be filtered, <code>contract.filters.countIncremented(null,10),</code> won’t work.</li>
<li>Different listeners for same event type might interfere with each other, only one of them will catch the event.</li>
</ul>
<h2 id="provider-on"><a href="#provider-on" class="headerlink" title="provider.on"></a><code>provider.on</code></h2><p>provider.on is more general and allows you to listen for any blockchain events, not just events emitted by a specific contract. It’s helpful for listening to logs, block events, or specific transaction events.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/15/webpack-101/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/15/webpack-101/" itemprop="url">Webpack Setup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-15T10:13:26+08:00">
                2024-09-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="target-Setting-up-webpack-to-do-basic-smart-contract-interaction"><a href="#target-Setting-up-webpack-to-do-basic-smart-contract-interaction" class="headerlink" title="target: Setting up webpack to do basic smart contract interaction"></a>target: Setting up webpack to do basic smart contract interaction</h1><h2 id="1-install-Webpack"><a href="#1-install-Webpack" class="headerlink" title="1. install Webpack"></a>1. install Webpack</h2><p>First, make sure you have Node.js and npm (or yarn) installed on your system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack webpack-cli typescript ts-loader html-webpack-plugin</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack: Bundles your files.</li>
<li>webpack-cli: Webpack’s command-line interface.</li>
<li>typescript: Adds TypeScript support.</li>
<li>ts-loader: Loads TypeScript files for Webpack.</li>
<li>html-webpack-plugin: Generates an index.html file automatically and injects the bundled JavaScript.</li>
</ul>
<h2 id="Create-the-project-structure"><a href="#Create-the-project-structure" class="headerlink" title="Create the project structure"></a>Create the project structure</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my-project/</span><br><span class="line">├── src/</span><br><span class="line">│   └── index.js  (your entry JavaScript/TypeScript file)</span><br><span class="line">├── dist/         (where the bundled output will go)</span><br><span class="line">├── package.json  (project metadata, scripts, and dependencies)</span><br><span class="line">└── webpack.config.js  (Webpack configuration file)</span><br></pre></td></tr></table></figure>

<p>(hardhat would do most of this for us)</p>
<h2 id="3-Create-webpack-config-js-and-tsconfig-json"><a href="#3-Create-webpack-config-js-and-tsconfig-json" class="headerlink" title="3. Create webpack.config.js and tsconfig.json"></a>3. Create webpack.config.js and tsconfig.json</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>, <span class="comment">// Entry point</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>, <span class="comment">// Output bundle</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>), <span class="comment">// Output directory</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// Clean the output directory before each build</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.js&quot;</span>], <span class="comment">// Resolve both .ts and .js files</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>, <span class="comment">// Use ts-loader for .ts files</span></span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="comment">// Use style-loader and css-loader for CSS files</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// Automatically inject the bundle into the HTML</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>, <span class="comment">// Use development mode for easier debugging</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-start-the-server"><a href="#4-start-the-server" class="headerlink" title="4. start the server"></a>4. start the server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn webpack serve</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/12/Solidity-lesson3.1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/09/12/Solidity-lesson3.1/" itemprop="url">Solidity Lesson 3.1 - Connecting to Metamask</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-09-12T20:45:37+08:00">
                2024-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Target-Interact-with-deployed-contracts-using-Metamask"><a href="#Target-Interact-with-deployed-contracts-using-Metamask" class="headerlink" title="Target: Interact with deployed contracts using Metamask"></a>Target: Interact with deployed contracts using Metamask</h1><h2 id="1-Set-up-webpack"><a href="#1-Set-up-webpack" class="headerlink" title="1. Set up webpack"></a>1. Set up webpack</h2><ul>
<li><p>Create webpack.common.js under project root</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dotenv = <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>);</span><br><span class="line">dotenv.<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>, <span class="comment">// bundle&quot;s entry point</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>), <span class="comment">// output directory</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>, <span class="comment">// name of the generated bundle</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">inject</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Adding webpack dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D webpack webpack-cli ts-loader html-webpack-plugin dotenv webpack-dev-server</span><br></pre></td></tr></table></figure></li>
<li><p>tsconfig.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">        &quot;resolveJsonModule&quot;: true,</span><br><span class="line">        &quot;esModuleInterop&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-Interaction-using-Metamask"><a href="#2-Interaction-using-Metamask" class="headerlink" title="2. Interaction using Metamask"></a>2. Interaction using Metamask</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">const</span> eth = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">  <span class="keyword">if</span> (!eth) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestAccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eth = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="keyword">await</span> eth.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> result &amp;&amp; result.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hasSigners</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metamask = <span class="title function_">getEth</span>();</span><br><span class="line">  <span class="keyword">const</span> signers = (<span class="keyword">await</span> metamask.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span>,</span><br><span class="line">  &#125;)) <span class="keyword">as</span> <span class="built_in">string</span>[];</span><br><span class="line">  <span class="keyword">return</span> signers.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getContract</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 地址</span></span><br><span class="line">  <span class="comment">// 2. 方法名</span></span><br><span class="line">  <span class="comment">// 3. provider</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">hasSigners</span>()) &amp;&amp; !(<span class="keyword">await</span> <span class="title function_">requestAccess</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No ethereum provider found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="title class_">AbstractProvider</span>(<span class="title function_">getEth</span>());</span><br><span class="line">  <span class="keyword">const</span> address = process.<span class="property">env</span>.<span class="property">CONTRACT_ADDRESS</span>;</span><br><span class="line">  <span class="keyword">const</span> contract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    address,</span><br><span class="line">    [<span class="string">&quot;function hello() pure public returns (string memory)&quot;</span>],</span><br><span class="line">    provider</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = <span class="keyword">await</span> contract.<span class="title function_">hello</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getContract</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>getEth():<ul>
<li>window.ethereum is the provider injected by Ethereum wallets</li>
</ul>
</li>
<li>requestAccess()<ul>
<li><code>eth_requestAccounts</code> this command would prompt the user to grant permission for this website to access their Metamask acconts and return.</li>
<li>if the user has already granted permission, this will not trigger the prompt.</li>
</ul>
</li>
<li>hasSigners()<ul>
<li><code>eth_accounts</code> returns currently connected accounts.</li>
</ul>
</li>
<li><code>const contract = new ethers.Contract(address, abi, providerOrSigner);</code><ul>
<li>ethers.Contract() creates an instance of a deployed contract, allowing you to interact with it by calling its functions (read&#x2F;write) and listening for events.</li>
<li>Parameters:<ul>
<li>ABI: we are using human-readable ABI in the code above</li>
<li>Provider or Signer: Provider (for read-only operations) or a Signer (for sending transactions from a specific Ethereum account)</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
